"use strict";var app=angular.module("atadosApp",["restangular","ui.router","ui.bootstrap","facebook","google-maps"]);angular.element(document).ready(function(){angular.bootstrap(document,["atadosApp"])}),app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){a.state("root",{url:"","abstract":!0,templateUrl:"/views/root.html",controller:"AppCtrl"}).state("root.home",{url:"/",templateUrl:"/views/home.html",controller:"HomeCtrl"}).state("root.about",{url:"/sobre",templateUrl:"/views/about.html",controller:"AboutCtrl"}).state("root.404",{url:"/404",templateUrl:"/views/404.html"}).state("root.explore",{url:"/explore",templateUrl:"/views/explore.html",controller:"ExplorerCtrl"}).state("root.volunteer",{url:"/voluntario/:slug",templateUrl:"/views/volunteerProfile.html",controller:"VolunteerCtrl",resolve:{volunteer:function(a,b){a.one("volunteers",b.slug).get().then(function(a){console.log("response "+a)},function(a){console.log("error "+a)})}}}).state("root.nonprofit",{url:"/ong/:slug",templateUrl:"/views/nonprofitProfile.html",controller:"NonprofitCtrl",resolve:{}}).state("root.nonprofitadmin",{url:"/admin",templateUrl:"/views/nonprofitAdminPanel.html",controller:"NonprofitAdminCtrl",resolve:{}}).state("root.nonprofitsignup",{url:"/cadastro/ong",templateUrl:"/views/nonprofitSignup.html",controller:"NonprofitSignupCtrl",resolve:{}}).state("root.project",{url:"/ato/:slug",templateUrl:"/views/projectPage.html",controller:"ProjectCtrl",resolve:{}}).state("root.newproject",{url:"/ato",templateUrl:"/views/projectNew.html",controller:"ProjectNewCtrl",resolve:{}}).state("root.newproject.job",{templateUrl:"/views/projectNewJob.html",resolve:{}}).state("root.newproject.work",{templateUrl:"/views/projectNewWork.html",resolve:{}}).state("root.newproject.donation",{templateUrl:"/views/projectNewDonation.html",resolve:{}}),c.html5Mode(!0).hashPrefix("!")}]),app.config(["$httpProvider",function(a){var b=["$location","$q",function(a,b){function c(a){return a}function d(a){return 401===a.status?b.reject(a):403===a.status?($.removeCookie(constants.accessTokenCookie),$.removeCookie(constants.csrfCookie),$.removeCookie(constants.sessionIdCookie),b.reject(a)):b.reject(a)}return function(a){return a.then(c,d)}}];a.responseInterceptors.push(b)}]),app.config(["FacebookProvider",function(a){a.init(constants.facebookClientId),a.setLocale(constants.locale),a.setCookie(!1),window.facebook=a}]),app.config(["RestangularProvider",function(a){a.setBaseUrl(constants.api),a.setDefaultHttpFields({cache:!0}),a.setRequestSuffix("/.json"),a.setResponseExtractor(function(a,b){if("getList"===b){var c=a.results;return c._resultmeta={count:a.count,next:a.next,previous:a.previous},c}return a})}]);var constants={devApi:"http://localhost:8000/v1/",devStorage:"http://localhost:8000/static/images/",prodApi:"http://beta.atados.com.br/v1/",prodStorage:"https://s3-sa-east-1.amazonaws.com/atadosapp/images/",clientId:"da4bc76b44b73cda7e4d",clientSecret:"3414d4cc0fb94521f0361ee5aba1b7eb73b5a468",facebookClientId:"307143646092581",locale:"pt_BR",accessTokenCookie:"access_token",csrfCookie:"csrftoken",sessionIdCookie:"sessionid",grantType:"password",page_size:9,static_page_size:50};constants.api=constants.prodApi,constants.storage=constants.prodStorage;var app=angular.module("atadosApp");app.filter("as_location_string",function(){return function(a){if(!a)return"";var b=a.addressline+", ";return b+=a.addressnumber+" - ",b+=a.suburb.name+" - ",b+=a.city.name+", "+a.state.code,b+=" - "+a.zipcode}});var NONPROFIT="NONPROFIT",VOLUNTEER="VOLUNTEER";toastr.options.closeButton=!0,toastr.options.hideEasing="linear";var app=angular.module("atadosApp");app.controller("AppCtrl",["$scope","$rootScope","$modal","$state","$location","$anchorScroll","Site","Auth","Search",function(a,b,c,d,e,f,g,h,i){a.site=g,a.search=i,a.modalInstance=null,a.storage=constants.storage,a.causes=g.causes,a.skills=g.skills,a.cities=g.cities,a.states=g.states,a.suburbs=g.suburbs,a.citySearch=function(b){a.cities().forEach(function(c){return c.name===b?(a.search.city=c,e.hash("top"),f(),void 0):void 0})},a.siteSearch=function(){d.transitionTo("root.explore")},h.getCurrentUser(function(b){a.loggedUser=b},function(){}),b.$on("userLoggedIn",function(b,c){c&&(a.loggedUser=c,a.loggedUser.role===NONPROFIT?d.transitionTo("root.nonprofitadmin"):a.loggedUser.role===VOLUNTEER||toastr.error("Usuário desconhecido acabou de logar."),a.modalInstance.close()&&a.modalInstance.close(),toastr.success("Oi! Bom te ver por aqui :)",a.loggedUser.slug),d.transitionTo("root.explore"))}),a.openVolunteerModal=function(){a.modalInstance=c.open({templateUrl:"/views/volunteerModal.html"})},a.openNonprofitModal=function(){a.modalInstance=c.open({templateUrl:"/views/nonprofitModal.html"})},a.openTermsModal=function(){a.modalInstance=c.open({templateUrl:"/views/termsModal.html",windowClass:"width: 1000px;"})},b.closeNonprofitLoginModal=function(){a.modalInstance.close()},a.logout=function(){toastr.success("Tchau até a próxima :)",a.loggedUser.slug),h.logout(),a.loggedUser=null}}]),app.controller("HomeCtrl",["$scope",function(a){a.site.title="Atados - Juntando Gente Boa"}]),app.controller("LoginCtrl",["$scope","$rootScope","Auth","Facebook",function(a,b,c){a.showForgotPassword=!1,a.remember=!0,a.wrongCredentials=!1,a.$watch("forgotEmail",function(b){b?c.isEmailUsed(b,function(){a.resetPasswordForm.forgotEmail.alreadyUsed=!1,a.resetPasswordForm.forgotEmail.$invalid=!0},function(){a.resetPasswordForm.forgotEmail.alreadyUsed=!0,a.resetPasswordForm.forgotEmail.$invalid=!1}):a.resetPasswordForm.forgotEmail.$invalid=!0}),a.login=function(){a.password&&a.email&&c.login({username:a.email,password:a.password,remember:a.remember},function(){c.getCurrentUser(function(a){b.$emit("userLoggedIn",a)},function(a){toastr.error(a)})},function(){a.wrongCredentials=!0})},a.forgotPassword=function(){a.showForgotPassword=!a.showForgotPassword},a.resetPassword=function(){c.resetPassword(a.forgotEmail,function(){toastr.info("Agora veja seu email para receber sua nova senha. Depois você pode mudar para uma senha da sua preferência.")},function(){toastr.error("Sua senha não pode ser mandada. Por favor mande um email para o administrador marjori@atados.com.br")})}}]),app.controller("VolunteerModalCtrl",["$scope","Facebook","Auth","$rootScope",function(a,b,c,d){function e(a){c.facebookAuth(a,function(a){d.$emit("userLoggedIn",a)},function(){toastr.error("Houve um error no servidor tentando logar com sua conta no Facebook.")})}a.loginActive=!0,a.$watch("loginActive",function(b){a.facebookState=b?"Entrar ":"Criar conta "}),a.$watch(function(){return b.isReady()},function(){a.facebookReady=!0}),a.facebookAuth=function(){b.getLoginStatus(function(a){"connected"!==a.status?b.login(function(b){"connected"===b.status?e(b.authResponse):"not_authorized"===a.status},{scope:"email"}):a.authResponse?e(a.authResponse):toastr.error("Could not get facebook credentials")})}}]),app.controller("VolunteerSignupCtrl",["$scope","$rootScope","Auth",function(a,b,c){a.$watch("slug",function(b){b?b.indexOf(" ")>=0?(a.signupForm.slug.$invalid=!0,a.signupForm.slug.hasSpace=!0):(a.signupForm.slug.hasSpace=!1,a.signupForm.slug.$invalid=!1,c.isSlugUsed(b,function(){a.signupForm.slug.alreadyUsed=!1,a.signupForm.slug.$invalid=!1},function(){a.signupForm.slug.alreadyUsed=!0,a.signupForm.slug.$invalid=!0})):(a.signupForm.slug.alreadyUsed=!1,a.signupForm.slug.hasSpace=!1,a.signupForm.slug.$invalid=!1)}),a.$watch("email",function(b){b&&c.isEmailUsed(b,function(){a.signupForm.email.alreadyUsed=!1,a.signupForm.email.$invalid=!1},function(){a.signupForm.email.alreadyUsed=!0,a.signupForm.email.$invalid=!0})}),a.$watch("password + passwordConfirm",function(){a.passwordDoesNotMatch=a.password!==a.passwordConfirm}),a.signup=function(){a.signupForm.$valid&&c.volunteerSignup({slug:a.slug,email:a.email,password:a.password},function(){c.login({username:a.email,password:a.password,remember:a.remember},function(){c.getCurrentUser(function(a){toastr.success("Oi!",a.slug),b.$emit("userLoggedIn",a)},function(a){toastr.error(a)})},function(){a.error="Usuário ou senha estão errados :("})},function(a){toastr.error(a.detail)})}}]),app.controller("NonprofitSignupCtrl",["$scope","$filter","$state","Auth","Photos",function(a,b,c,d,e){a.nonprofit={address:{neighborhood:null,zipcode:null,addressline:null,addressnumber:null,suburbs:null},phone:null,description:null,name:null,slug:null,details:null,user:{first_name:null,slug:null,last_name:null,email:null,password:null},facebook_page:null,google_page:null,twitter_handle:null,website:null,causes:[]},a.$watch("nonprofit.user.email",function(b){d.isEmailUsed(b,function(){a.signupForm.email.alreadyUsed=!1,a.signupForm.email.$invalid=!1},function(){a.signupForm.email.alreadyUsed=!0,a.signupForm.email.$invalid=!0})}),a.$watch("nonprofit.user.slug",function(b){b?b.indexOf(" ")>=0?(a.signupForm.slug.$invalid=!0,a.signupForm.slug.hasSpace=!0):(a.signupForm.slug.$invalid=!1,a.signupForm.slug.hasSpace=!1,d.isSlugUsed(b,function(){a.signupForm.slug.alreadyUsed=!1,a.signupForm.slug.$invalid=!1},function(){a.signupForm.slug.alreadyUsed=!0,a.signupForm.slug.$invalid=!0})):(a.signupForm.slug.alreadyUsed=!1,a.signupForm.slug.hasSpace=!1,a.signupForm.slug.$invalid=!1)}),a.$watch("password + passwordConfirm",function(){a.signupForm.password.doesNotMatch=a.password!==a.passwordConfirm,a.signupForm.password.$invalid=a.signupForm.password.doesNotMatch}),a.$watch("nonprofit.causes",function(a){console.log(a)}),a.addCause=function(b){if(b.checked=!b.checked,b.checked)a.nonprofit.causes.push(b);else{var c=a.nonprofit.causes.indexOf(b);c>-1&&a.nonprofit.causes.splice(c,1)}},a.uploadFile=function(b){if(b){var c=new FormData;c.append("file",b[0]),e.setVolunteerPhoto(c,function(b){a.image=b.file},function(){toastr.error("Error no servidor. Não consigo atualizar sua foto :(")})}},a.signup=function(){a.nonprofit.user.password=a.password,console.log(a.nonprofit),d.nonprofitSignup(a.nonprofit,function(){toastr.success("Bem vinda ONG ao atados!"),c.transitionTo("root.nonprofitadmin")},function(a){toastr.error(a)})}}]),app.controller("VolunteerCtrl",["$scope","$filter","$state","$stateParams","$http","Auth","Photos","Restangular",function(a,b,c,d,e,f,g,h){a.site.title="Voluntário - "+d.slug,h.one("volunteers",d.slug).get().then(function(b){a.volunteer=b,a.volunteer.id=a.volunteer.slug,a.image=a.volunteer.image_url},function(){c.transitionTo("root.home"),toastr.error("Voluntário não encontrado")}),a.saveVolunteer=function(){a.volunteer.causes=b("filter")(a.causes(),{checked:!0});var c=0;a.volunteer.causes.forEach(function(b){a.volunteer.causes[c++]=b.url}),a.volunteer.skills=b("filter")(a.skills,{checked:!0}),c=0,a.volunteer.skills.forEach(function(b){a.volunteer.skills[c++]=b.url}),a.volunteer.put().then(function(){toastr.success("Perfil salvo!",a.volunteer.slug)},function(){toastr.error("Problema em salvar seu perfil :(")}),a.password&&a.password===a.passwordConfirm&&f.changePassword({email:a.volunteer.user.email,password:a.password},function(){toastr.success("Senha nova salva",a.volunteer.slug)},function(){toastr.error("Não conseguimos atualizar sua senha :(")})},a.$watch("causes + volunteer.causes",function(){a.causes()&&a.volunteer&&a.volunteer.causes.forEach(function(b){for(var c=0;c<a.causes().length;++c){var d=a.causes()[c];if(d.url===b){d.checked=!0;break}}})}),a.$watch("skills + volunteer.skills",function(){a.skills&&a.volunteer&&a.volunteer.skills&&a.volunteer.skills.forEach(function(b){for(var c=0;c<a.skills.length;++c){var d=a.skills[c];if(d.url===b){d.checked=!0;break}}})}),a.$watch("volunteer.user.email",function(b){a.loggedUser&&(b&&b!==a.loggedUser.user.email?a.profileForm.email.alreadyUsed=!1:b!==a.loggedUser.user.email&&f.isEmailUsed(b,function(){a.profileForm.email.alreadyUsed=!1,a.profileForm.email.$invalid=!1},function(){a.profileForm.email.alreadyUsed=!0,a.profileForm.email.$invalid=!0}))}),a.$watch("password + passwordConfirm",function(){a.profileForm.password.doesNotMatch=a.password!==a.passwordConfirm,a.profileForm.password.$invalid=a.profileForm.password.doesNotMatch}),a.uploadFile=function(b){if(b){var c=new FormData;c.append("file",b[0]),g.setVolunteerPhoto(c,function(b){a.image=b.file},function(){toastr.error("Error no servidor. Não consigo atualizer sua foto :(")})}}}]),app.controller("NonprofitCtrl",["$scope","$state","$stateParams","$http","Auth","Restangular",function(a,b,c,d,e,f){function g(b){var c=new google.maps.Geocoder;c.geocode({address:b.addressline,region:"br"},function(b,c){if(c===google.maps.GeocoderStatus.OK){var d={latitude:b[0].geometry.location.lat(),longitude:b[0].geometry.location.lng()};a.center=d,a.markers.push(d),a.mapReady=!0}})}angular.extend(a,{center:{latitude:-23.553287,longitude:-46.638535},markers:[],zoom:14}),f.one("nonprofits",c.slug).get().then(function(b){a.nonprofit=b,a.site.title="ONG "+a.nonprofit.user.slug,a.nonprofit.id=a.nonprofit.user.slug,a.image=a.nonprofit.image_url?a.nonprofit.image_url:"http://www.tokyocomp.com.br/imagens/estrutura/sem_foto.gif",a.coverImage=a.nonprofit.cover_url?a.nonprofit.cover_url:"http://www.jonloomer.com/wp-content/uploads/2012/04/cover_profile_new_layers3.jpg",g(a.nonprofit.user.address)},function(){b.transitionTo("root.home"),toastr.error("Ong não encontrada.")})}]),app.controller("NonprofitAdminCtrl",["$scope","$state",function(a,b){a.loggedUser&&"VOLUNTEER"!==a.loggedUser.role||(b.transitionTo("root.home"),toastr.error("Apenas ONGs tem acesso ao Painel de Controle"))}]),app.controller("ProjectCtrl",function(){}),app.controller("ProjectNewCtrl",["$scope","$filter","$state","Auth","Restangular",function(a,b,c,d,e){a.minDate=new Date,a.ismeridian=!0,a.toggleMode=function(){a.ismeridian=!a.ismeridian},a.typeOfProject="job",c.transitionTo("root.newproject.job"),a.changeType=function(b){a.typeOfProject=b},a.project={name:"",nonprofit:a.loggedUser,slug:"",responsible:"",causes:""},a.job={address:{},skills:[],roles:[],start_date:new Date,end_date:new Date},a.work={address:{},availabilities:[],roles:[],skills:[],weekly_hours:0,can_be_done_remotely:!1},a.newRole={name:"",prerequisites:"",vacancies:0},a.removeRole=function(b,c){"job"===c?a.job.roles.splice(a.job.roles.indexOf(b),1):"work"===c&&a.work.roles.splice(a.work.roles.indexOf(b),1)},a.addRole=function(b){b&&("job"===b?(a.job.roles.push(a.newRole),a.newRole={}):"work"===b?a.work.roles.push(a.newRole):toastr.error("Problema inesperado, me desculpe!"))},e.all("suburbs").getList().then(function(b){a.suburbs=b},function(){toastr.error("Não consegui pegar as Zonas do servidor.")}),a.$watch("project.slug",function(b){b?b.indexOf(" ")>=0?(a.newProjectForm.slug.$invalid=!0,a.newProjectForm.slug.hasSpace=!0):(a.newProjectForm.slug.$invalid=!1,a.newProjectForm.slug.hasSpace=!1,d.isProjectSlugUsed(b,function(){a.newProjectForm.slug.alreadyUsed=!1,a.newProjectForm.slug.$invalid=!1},function(){a.newProjectForm.slug.alreadyUsed=!0,a.newProjectForm.slug.$invalid=!0})):(a.newProjectForm.slug.alreadyUsed=!1,a.newProjectForm.slug.hasSpace=!1,a.newProjectForm.slug.$invalid=!1)});var f=function(){if(a.project.skills){a.project.skills=b("filter")(a.skills,{checked:!0});var c=0;a.project.skills.forEach(function(b){a.project.skills[c++]=b.url})}var d=e.all("roles");d.post(a.job.roles).then(function(b){a.job.roles=[],b.forEach(function(b){a.job.roles.push(b.id)}),a.project.job=a.job;var c=e.all("projects");c.post(a.project).then(function(){toastr.success("Ato criado!",a.project.name)},function(){toastr.error("Problema em criar ato :(")})})},g=function(){a.project.work=a.work};a.createProject=function(){a.project.causes=b("filter")(a.causes(),{checked:!0});var c=0;switch(a.project.causes.forEach(function(b){a.project.causes[c++]=b.url}),a.project.nonprofit=a.loggedUser.url,a.typeOfProject){case"job":f();break;case"work":g()}}}]),app.controller("LandingCtrl",["$scope",function(a){a.site.title="Atados - Juntando Gente Boa",a.landing=!0}]),app.controller("AboutCtrl",["$scope",function(a){a.site.title="Atados - Sobre"}]),app.controller("ExplorerCtrl",["$scope",function(a){a.site.title="Atados - Explore",a.landing=!1,angular.extend(a,{map:{center:{latitude:-23.553287,longitude:-46.638535},markers:[],zoom:10,dragging:!1}});var b=function(a){a.showWindow=!0};a.onMarkerClicked=b,a.map.markers.forEach(function(c){c.closeClick=function(){c.showWindow=!1,a.$apply()},c.onClicked=function(){b(c)}})}]),app.controller("SearchCtrl",["$scope","Restangular","$http","$location","$anchorScroll","Search",function(a,b,c,d,e,f){a.search=f,a.$watch("search.cause",function(b,c){b!==c&&a.search.filter(f.query,f.cause.id,f.skill.id,f.city.id)}),a.$watch("search.skill",function(b,c){b!==c&&a.search.filter(f.query,f.cause.id,f.skill.id,f.city.id)}),a.$watch("search.city",function(b,c){b!==c&&a.search.filter(f.query,f.cause.id,f.skill.id,f.city.id)}),a.$watch("search.query",function(b,c){b!==c&&a.search.filter(f.query,f.cause.id,f.skill.id,f.city.id)}),a.getMore=function(){if(a.landing){var b={showProjects:a.showProjects,city:a.search.city,cause:a.search.cause,skill:a.search.skill};a.$emit("landingToExplorer",b)}else a.search.nextUrl?c.get(a.search.nextUrl).success(function(a){a.results._restultmeta={next:a.next}}).error(function(){toastr.error("Erro ao buscar mais atos do servidor")}):toastr.error("Não conseguimos achar mais atos. Tente mudar os filtros.")}}]);var app=angular.module("atadosApp");app.directive("removerole",function(){return{restrict:"E",template:'<button type="destroy" ng-click="removeRole(role, "work")"><i class="fa fa-trash-o"></i></button>'}}),app.directive("button",function(){return{restrict:"E",compile:function(a,b){"submit"===b.type?a.addClass("btn-primary"):"destroy"===b.type?a.addClass("destroy"):b.type&&a.addClass("btn-"+b.type),b.size&&a.addClass("btn-"+b.size)}}}),app.directive("button-facebook",function(){return{restrict:"E"}}),app.directive("projectCard",function(){return{restrict:"E",templateUrl:"/views/projectCard.html"}}),app.directive("atadosSearch",function(){return{restrict:"E",templateUrl:"/views/search.html",controller:"SearchCtrl"}}),app.directive("nonprofitCard",function(){return{restrict:"E",templateUrl:"/views/nonprofitCard.html"}}),app.directive("debug",function(){return{restrict:"E",scope:{expression:"=val"},template:"<pre>{{debug(expression)}}</pre>",link:function(a){a.debug=function(a){return angular.toJson(a,!0)}}}}),app.directive("phone",function(){return{restrict:"E",scope:{number:"@"},template:'<p><i class="fa fa-phone"></i> {{number}}</p>'}}),app.directive("email",function(){return{restrict:"E",scope:{email:"@"},template:'<p><i class="fa fa-laptop"></i> {{email}}</p>'}}),app.directive("contactatados",function(){return{restrict:"E",scope:{},template:'<p>Entre em <a href="mailto:contato@atados.com.br?Subject=Ajuda%20Atados!" target="_blank">contato</a> se estiver tendo problemas.</p>'}}),app.directive("doubtAtados",function(){return{restrict:"E",scope:{},template:'<p>Entre em <a href="mailto:contato@atados.com.br?Subject=Ajuda%20Atados!" target="_blank">contato</a> se estiver com dúvida.</p>'}}),app.directive("backgroundImg",function(){return function(a,b,c){var d=c.backgroundImg;b.css({"background-image":"url("+d+")","background-size":"cover"})}});var app=angular.module("atadosApp");app.factory("Cookies",["$q","$timeout",function(a,b){return{get:function(c){var d=a.defer();return b(function(){d.resolve($.cookie(c))},0),d.promise},getAll:function(){return $.cookie()},set:function(a,b,c){return $.cookie(a,b,c)},"delete":function(a){return $.removeCookie(a)}}}]),app.factory("Site",["Restangular",function(a){var b=[],c=[],d=[],e=[],f=[],g=function(){a.all("causes").getList({page_size:constants.static_page_size}).then(function(a){b=a,b.forEach(function(a){a.class="cause_"+a.id}),b.splice(0,0,{name:"Todas Causas",id:"","class":"cause_0"})},function(){console.error("Não consegui pegar as causas do servidor.")})},h=function(){a.all("skills").getList({page_size:constants.static_page_size}).then(function(a){c=a,c.splice(0,0,{name:"Todas Habilidades",id:""})},function(){console.error("Não consegui pegar as habilidades do servidor.")})},i=function(){a.all("cities").getList({page_size:constants.static_page_size}).then(function(a){d=a,d.splice(0,0,{name:"Todas Cidades",id:""})},function(){console.error("Não consegui pegar as cidades do servidor.")})},j=function(){a.all("states").getList({page_size:constants.static_page_size}).then(function(a){e=a},function(){console.error("Não consegui pegar os estados do servidor.")})},k=function(){a.all("suburbs").getList({page_size:constants.static_page_size}).then(function(a){f=a},function(){console.error("Não consegui pegar as Zonas do servidor.")})};return g(),h(),i(),j(),k(),{name:"Atados - Juntando Gente Boa",title:"Atados - Juntando Gente Boa",contactEmail:"contato@atados.com.br",copyright:"Atados, "+(new Date).getFullYear(),termsOfService:function(){},privacy:function(){},team:[{name:"Marjori Pomarole",email:"marjori@atados.com.br",photo:"URL here",description:"Hi I am the programmer",facebook:"marjoripomarole"}],causes:function(){return b},skills:function(){return c},cities:function(){return d},states:function(){return e},suburbs:function(){return f}}}]),app.factory("Search",["Restangular",function(a){function b(a){var b=a.address,c=new google.maps.Geocoder,d=m(b);c.geocode({address:d,region:"br"},function(b,c){c===google.maps.GeocoderStatus.OK?(a.coords={latitude:b[0].geometry.location.lat(),longitude:b[0].geometry.location.lng(),showWindow:!0,icon:"heartblue16.png"},k.push(a.coords)):a.coords={}})}function c(b,c,d,e){var f={page_size:constants.page_size,query:b,cause:c,skill:d,city:e};a.all("projects").getList(f).then(function(a){n(a)},function(){console.error("Não consegui pegar os atos do servidor.")})}var d="",e={},f={},g={},h=[],i=[],j="",k=[],l=!0,m=function(a){if(a){var b=a.addressline+", "+a.addressnumber;return a.city&&(b+=" - "+a.city.name,a.city.state&&(b+=0+a.city.state.code)),b}return""},n=function(a){a.forEach(p),j=a._resultmeta?a._resultmeta.next:""},o=function(a){a.forEach(q),j=a._resultmeta?a._resultmeta.next:""},p=function(a){var c=function(a){return a.name};a.causesStr=a.causes.map(c).join("/"),b(a),h.push(a)},q=function(a){i.push(a)},r=function(b,c,d){var e={page_size:constants.page_size,query:b,cause:c,city:d};a.all("nonprofits").getList(e).then(function(a){o(a)})};return c(),r(),{filter:function(a,b,d,e){h=[],i=[],c(a,b,d,e),r(a,b,e)},query:d,cause:e,skill:f,city:g,nextUrl:j,projects:function(){return h},nonprofits:function(){return i},showProjects:l}}]),app.factory("Photos",["$http",function(a){var b=constants.api;return{setVolunteerPhoto:function(c,d,e){a.post(b+"upload_volunteer_image/",c,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(d).error(e)}}}]),app.factory("Auth",["$http","Cookies",function(a,b){function c(b){b&&(a.defaults.headers.common.Authorization="Bearer "+b)}var d,e=constants.api;return{facebookAuth:function(d,f,g){a.post(e+"facebook/",d).success(function(a){c(a.access_token),b.set(constants.accessTokenCookie,a.access_token),f(a.user)}).error(g)},resetPassword:function(b,c,d){a.post(e+"password_reset/",{email:b}).success(function(){c()}).error(d)},changePassword:function(b,c,d){a.put(e+"change_password/",b).success(function(){c()}).error(d)},isEmailUsed:function(b,c,d){b&&a.get(e+"check_email/?email="+b).success(function(a){c(a)}).error(d)},isSlugUsed:function(b,c,d){a.get(e+"check_slug/?slug="+b).success(function(a){c(a)}).error(d)},isProjectSlugUsed:function(b,c,d){b&&a.get(e+"check_project_slug/?slug="+b).success(function(a){c(a)}).error(d)},getCurrentUser:function(f,g){b.get(constants.accessTokenCookie).then(function(b){var h=b;h&&(c(h),a.get(e+"current_user/?id="+(new Date).getTime()).success(function(a){d=a,f(d)}).error(function(a){g(a)}))})},isLoggedIn:function(){return d?!0:!1},volunteerSignup:function(b,c,d){a.post(e+"create/volunteer/",b).success(function(){c()}).error(d)},nonprofitSignup:function(b,c,d){a.post(e+"create/nonprofit/",b).success(function(){c()}).error(d)},login:function(d,f,g){d.client_id=constants.clientId,d.client_secret=constants.clientSecret,d.grant_type=constants.grantType,a({method:"POST",url:e+"oauth2/access_token/",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(d)}).success(function(a){c(a.access_token),d.remember?b.set(constants.accessTokenCookie,a.access_token,{expires:30,path:"/"}):b.set(constants.accessTokenCookie,a.access_token),f(a)}).error(g)},logout:function(){a.post(e+"logout/"),d=null,b.delete(constants.accessTokenCookie),delete a.defaults.headers.common.Authorization},user:d}}]);