"use strict";var app=angular.module("atadosApp",["restangular","ui.router","ui.bootstrap","facebook","AngularGM"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){a.state("root",{url:"","abstract":!0,templateUrl:"partials/root.html",controller:"RootCtrl"}).state("root.home",{url:"/",templateUrl:"partials/home.html",controller:"HomeCtrl"}).state("root.about",{url:"/sobre",templateUrl:"partials/about.html",controller:"AboutCtrl"}).state("root.404",{url:"/404",templateUrl:"partials/404.html"}).state("root.explore",{url:"/explore",templateUrl:"partials/explore.html",controller:"ExplorerCtrl"}).state("root.volunteer",{url:"/voluntario/:slug",templateUrl:"partials/volunteerProfile.html",controller:"VolunteerCtrl"}).state("root.volunteeredit",{url:"/editar",templateUrl:"partials/volunteerEdit.html",controller:"VolunteerEditCtrl"}).state("root.nonprofit",{url:"/ong/:slug",templateUrl:"partials/nonprofitProfile.html",controller:"NonprofitCtrl"}).state("root.nonprofitadmin",{url:"/controle",templateUrl:"partials/nonprofitAdminPanel.html",controller:"NonprofitAdminCtrl"}).state("root.nonprofitsignup",{url:"/cadastro/ong",templateUrl:"partials/nonprofitSignup.html",controller:"NonprofitSignupCtrl",resolve:{}}).state("root.project",{url:"/ato/:slug",templateUrl:"partials/projectPage.html",controller:"ProjectCtrl",resolve:{}}).state("root.newproject",{url:"/ato",templateUrl:"partials/projectNew.html",controller:"ProjectNewCtrl",resolve:{}}).state("root.newproject.job",{templateUrl:"partials/projectNewJob.html",resolve:{}}).state("root.newproject.work",{templateUrl:"partials/projectNewWork.html",resolve:{}}).state("legacynonprofit",{url:"/site/instituicoes/:nonprofitUid/profile",controller:"LegacyCtrl"}).state("legacyVolunteerOrNonprofit",{url:"/site/users/:slug",controller:"LegacyCtrl"}).state("legacyproject",{url:"/site/ato/:projectUid",controller:"LegacyCtrl"}),b.otherwise("/404"),c.html5Mode(!0).hashPrefix("!")}]),app.config(["$httpProvider",function(a){var b=["$location","$q",function(a,b){function c(a){return a}function d(a){return 401===a.status?b.reject(a):403===a.status?($.removeCookie(constants.accessTokenCookie),$.removeCookie(constants.csrfCookie),$.removeCookie(constants.sessionIdCookie),b.reject(a)):b.reject(a)}return function(a){return a.then(c,d)}}];a.responseInterceptors.push(b)}]),app.config(["FacebookProvider",function(a){a.init(constants.facebookClientId),a.setLocale(constants.locale),a.setCookie(!1),window.facebook=a}]),app.config(["RestangularProvider",function(a){a.setBaseUrl(constants.api),a.setDefaultHttpFields({cache:!0}),a.setRequestSuffix("/.json"),a.setRestangularFields({id:"slug"}),a.setResponseExtractor(function(a,b){if("getList"===b){var c=a.results;return c._resultmeta={count:a.count,next:a.next,previous:a.previous},c}return a})}]);var constants={devApi:"http://www.atadoslocal.com.br:8000/v1/",devStorage:"http://www.atadoslocal.com.br:8000/static/images/",prodApi:"http://beta.atados.com.br/v1/",prodStorage:"https://s3-sa-east-1.amazonaws.com/atadosapp/images/",clientId:"da4bc76b44b73cda7e4d",clientSecret:"3414d4cc0fb94521f0361ee5aba1b7eb73b5a468",facebookClientId:"307143646092581",locale:"pt_BR",accessTokenCookie:"access_token",csrfCookie:"csrftoken",sessionIdCookie:"sessionid",grantType:"password",page_size:8,active_cities:4,static_page_size:300,weekdays:[{1:"Segunda"},{2:"Terça"},{3:"Quarta"},{4:"Quinta"},{5:"Sexta"},{6:"Sabado"},{7:"Domingo"}],periods:[{0:"Manha"},{1:"Tarde"},{2:"Noite"}],markers:[],map:null,saoPauloCenter:new google.maps.LatLng(-23.5505199,-46.6333094),curitibaCenter:new google.maps.LatLng(-25.4808762,-49.3044253),brasiliaCenter:new google.maps.LatLng(-15.79211,-47.897751),defaultZoom:11,VOLUNTEER:"VOLUNTEER",NONPROFIT:"NONPROFIT"};constants.api=constants.prodApi,constants.storage=constants.prodStorage,constants.selected=constants.storage+"heart.png",constants.notselected=constants.storage+"blue.png";var app=angular.module("atadosApp");app.directive("removerole",function(){return{restrict:"E",template:'<button type="destroy" ng-click="removeRole(role, "work")"><i class="fa fa-trash-o"></i></button>'}}),app.directive("button",function(){return{restrict:"E",compile:function(a,b){"submit"===b.type?a.addClass("btn-primary"):"destroy"===b.type?a.addClass("destroy"):b.type&&a.addClass("btn-"+b.type),b.size&&a.addClass("btn-"+b.size)}}}),app.directive("button-facebook",function(){return{restrict:"E"}}),app.directive("projectCard",function(){return{restrict:"E",templateUrl:"partials/projectCard.html"}}),app.directive("atadosSearch",function(){return{restrict:"E",templateUrl:"partials/search.html",controller:"SearchCtrl"}}),app.directive("nonprofitCard",function(){return{restrict:"E",templateUrl:"partials/nonprofitCard.html"}}),app.directive("phone",function(){return{restrict:"E",scope:{number:"@"},template:'<p><i class="fa fa-phone"></i> {{number}}</p>'}}),app.directive("email",function(){return{restrict:"E",scope:{email:"@"},template:'<p><i class="fa fa-laptop"></i> {{email}}</p>'}}),app.directive("contactatados",function(){return{restrict:"E",scope:{},template:'<p>Entre em <a href="mailto:contato@atados.com.br?Subject=Ajuda%20Atados!" target="_blank">contato</a> se estiver tendo problemas.</p>'}}),app.directive("doubtAtados",function(){return{restrict:"E",scope:{},template:'<p>Entre em <a href="mailto:contato@atados.com.br?Subject=Ajuda%20Atados!" target="_blank">contato</a> se estiver com dúvida.</p>'}}),app.directive("backgroundImg",function(){return function(a,b,c){var d=c.backgroundImg;b.css({"background-image":"url("+d+")","background-size":"cover"})}});var app=angular.module("atadosApp");app.factory("Cookies",["$q","$timeout",function(a,b){return{get:function(c){var d=a.defer();return b(function(){d.resolve($.cookie(c))},0),d.promise},getAll:function(){return $.cookie()},set:function(a,b,c){return $.cookie(a,b,c)},"delete":function(a){return $.removeCookie(a)}}}]),app.factory("Site",["Restangular","$http",function(a,b){var c=[],d=[],e=[],f=[],g={},h=constants.api,i=function(){b.get(h+"numbers/").success(function(a){a.projects?a.volunteers?a.nonprofits||(a.nonprofits=0):a.volunteers=0:a.projects=0,g=a})},j=function(){a.all("causes").getList({page_size:constants.static_page_size}).then(function(a){c=a,c.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png",a.class="cause_"+a.id}),c.splice(0,0,{name:"Todas Causas",id:"","class":"cause_0"})},function(){console.error("Não consegui pegar as causas do servidor.")})},k=function(){a.all("skills").getList({page_size:constants.static_page_size}).then(function(a){d=a,d.forEach(function(a){a.image=constants.storage+"skill_"+a.id+".png",a.class="skill_"+a.id}),d.splice(0,0,{name:"Todas Habilidades",id:""})},function(){console.error("Não consegui pegar as habilidades do servidor.")})},l=function(){a.all("cities").getList({page_size:constants.active_cities}).then(function(a){e=a,e.splice(0,0,{name:"Todas Cidades",id:"",active:!0,state:0})},function(){console.error("Não consegui pegar as cidades do servidor.")})},m=function(){a.all("states").getList({page_size:constants.static_page_size}).then(function(a){f=a},function(){console.error("Não consegui pegar os estados do servidor.")})};return j(),k(),l(),m(),i(),{name:"Atados - Juntando Gente Boa",title:"Atados - Juntando Gente Boa",contactEmail:"contato@atados.com.br",copyright:"Atados, "+(new Date).getFullYear(),termsOfService:function(){},privacy:function(){},team:[{name:"Marjori Pomarole",email:"marjori@atados.com.br",photo:"URL here",description:"Hi I am the programmer",facebook:"marjoripomarole"}],causes:function(){return c},skills:function(){return d},cities:function(){return e},states:function(){return f},numbers:function(){return g}}}]),app.factory("Search",["Restangular","Site",function(a,b){function c(b,c,d,e,f){f="undefined"!=typeof f?f:constants.page_size;var g={page_size:f,query:b,cause:c,skill:d,city:e};a.all("projects").getList(g).then(function(a){l(a)},function(){console.error("Não consegui pegar os atos do servidor.")})}var d="",e={},f={},g={},h=[],i=[],j="",k="",l=function(a){a.forEach(n),j=a._resultmeta?a._resultmeta.next:""},m=function(a){a.forEach(o),k=a._resultmeta?a._resultmeta.next:""},n=function(a){a.causes.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png",a.class="cause_"+a.id}),a.skills.forEach(function(a){a.image=constants.storage+"skill_"+a.id+".png",a.class="skill_"+a.id}),h.push(a),a.nonprofit.image_url="http://atadosapp.s3.amazonaws.com/"+a.nonprofit.image,a.nonprofit.slug=a.nonprofit.user.slug},o=function(a){var c=[];a.causes.forEach(function(a){a=b.causes()[a],c.push(a),a.image=constants.storage+"cause_"+a.id+".png",a.class="cause_"+a.id}),a.causes=c,a.address=a.user.address,i.push(a)},p=function(b,c,d){var e={page_size:20,query:b,cause:c,city:d};a.all("nonprofits").getList(e).then(function(a){m(a)})};return c(),p(),{filter:function(a,b,d,e){h=[],i=[],c(a,b,d,e),p(a,b,e)},query:d,cause:e,skill:f,city:g,showProjects:!0,nextUrlProject:function(){return j},nextUrlNonprofit:function(){return k},setNextUrlProject:function(a){j=a},setNextUrlNonprofit:function(a){k=a},projects:function(){return h},nonprofits:function(){return i}}}]),app.factory("Photos",["$http",function(a){var b=constants.api;return{setVolunteerPhoto:function(c,d,e){a.post(b+"upload_volunteer_image/",c,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(d).error(e)},setNonprofitProfilePhoto:function(c,d,e){a.post(b+"upload_nonprofit_profile_image/",c,{headers:{"Content-Type":void 0},transformRequest:angular.indenty}).success(d).error(e)},setNonprofitCoverPhoto:function(c,d,e){a.post(b+"upload_nonprofit_cover_image/",c,{headers:{"Content-Type":void 0},transformRequest:angular.indenty}).success(d).error(e)}}}]),app.factory("Legacy",["$http",function(a){var b=constants.api;return{nonprofit:function(c,d,e){a.get(b+"legacy_to_slug/nonprofit/?uid="+c).success(d).error(e)},project:function(c,d,e){a.get(b+"legacy_to_slug/project/?uid="+c).success(d).error(e)},users:function(c,d,e){a.get(b+"slug_role/?slug="+c).success(d).error(e)}}}]),app.factory("Auth",["$http","Cookies","Site",function(a,b,c){function d(b){b&&(a.defaults.headers.common.Authorization="Bearer "+b)}var e,f=constants.api,g=function(a){if(a&&a.causes){var b=[];a.causes.forEach(function(a){a=c.causes()[a],a.checked=!0,b.push(a)}),a.causes=b}},h=function(a){if(a&&a.skills){var b=[];a.skills.forEach(function(a){a=c.skills()[a],a.checked=!0,b.push(a)}),a.skills=b}},i=function(){b.get(constants.accessTokenCookie).then(function(b){return b?(d(b),a.get(f+"current_user/?id="+(new Date).getTime()).success(function(b){b.user.address&&b.user.address.city?a.get(f+"cities/"+b.user.address.city+"/").success(function(a){e=b,g(e),h(e),e.user.address.city=a,e.address=e.user.address}):(e=b,e.address=e.user.address,g(e),h(e))})):void 0})};return i(),{facebookAuth:function(c,e,g){a.post(f+"facebook/",c).success(function(a){d(a.access_token),b.set(constants.accessTokenCookie,a.access_token),e(a.user)}).error(g)},getCurrentUser:i,resetPassword:function(b,c,d){a.post(f+"password_reset/",{email:b}).success(function(){c()}).error(d)},changePassword:function(b,c,d){a.put(f+"change_password/",b).success(function(){c()}).error(d)},isEmailUsed:function(b,c,d){b&&a.get(f+"check_email/?email="+b+"?id="+(new Date).getTime()).success(function(a){c(a)}).error(d)},isSlugUsed:function(b,c,d){a.get(f+"check_slug/?slug="+b).success(function(a){c(a)}).error(d)},isProjectSlugUsed:function(b,c,d){b&&a.get(f+"check_project_slug/?slug="+b).success(function(a){c(a)}).error(d)},isLoggedIn:function(){return e?!0:!1},volunteerSignup:function(b,c,d){a.post(f+"create/volunteer/",b).success(function(){c()}).error(d)},nonprofitSignup:function(b,c,d){a.post(f+"create/nonprofit/",b).success(function(){c()}).error(d)},login:function(c,e,g){c.client_id=constants.clientId,c.client_secret=constants.clientSecret,c.grant_type=constants.grantType,a({method:"POST",url:f+"oauth2/access_token/",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(c)}).success(function(a){d(a.access_token),c.remember?b.set(constants.accessTokenCookie,a.access_token,{expires:30,path:"/"}):b.set(constants.accessTokenCookie,a.access_token),e(a)}).error(g)},logout:function(){a.post(f+"logout/"),e=null,b.delete(constants.accessTokenCookie),delete a.defaults.headers.common.Authorization},getUser:function(){return e}}}]),app.factory("Volunteer",["$http",function(a){return{save:function(b,c,d){var e={};angular.copy(b,e),delete e.projects,delete e.nonprofits,delete e.address,a.put(constants.api+"volunteers/"+e.slug+"/.json",e).success(c).error(d)}}}]);var app=angular.module("atadosApp");app.filter("as_location_string",function(){return function(a){if(!a)return"Não tem endereço.";var b=a.addressline+", ";return a.addressnumber&&(b+=a.addressnumber+" - "),a.addressline2&&(b+=a.addressline2+" - "),a.neighborhood&&(b+=a.neighborhood+" - "),a.city_state&&(b+=a.city_state),a.zipcode&&(b+=" - "+a.zipcode),b}}),app.filter("newlines",["$sce",function(a){return function(b){return b?a.trustAsHtml(b.replace(/\n/g,"<br/>")):void 0}}]),app.filter("noHTML",function(){return function(a){return a?a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"):void 0}});var app=angular.module("atadosApp");app.controller("AboutCtrl",["$scope",function(a){a.site.title="Atados - Sobre"}]);var app=angular.module("atadosApp");app.controller("AppCtrl",["$scope","$rootScope","$modal","$state","$location","$anchorScroll","Site","Auth","Search",function(a,b,c,d,e,f,g,h,i){a.site=g,a.search=i,b.modalInstance=null,a.storage=constants.storage,a.causes=g.causes,a.skills=g.skills,a.cities=g.cities,a.states=g.states,a.numbers=g.numbers,a.citySearch=function(b){a.cities().forEach(function(c){return c.name===b?(a.search.city=c,e.hash("top"),void f()):void 0})},a.siteSearch=function(){d.transitionTo("root.explore")},a.openVolunteerModal=function(){b.modalInstance=c.open({templateUrl:"partials/volunteerModal.html"})},a.openNonprofitModal=function(){b.modalInstance=c.open({templateUrl:"partials/nonprofitModal.html"})},a.openTermsModal=function(){b.modalInstance=c.open({templateUrl:"partials/termsModal.html",windowClass:"width: 1000px;"})},b.closeNonprofitLoginModal=function(){b.modalInstance.close()}}]);var app=angular.module("atadosApp");app.controller("HomeCtrl",["$scope",function(a){a.site.title="Atados - Juntando Gente Boa"}]);var app=angular.module("atadosApp");app.controller("LandingCtrl",["$scope",function(a){a.site.title="Atados - Juntando Gente Boa",a.landing=!0}]);var app=angular.module("atadosApp");app.controller("LegacyCtrl",["$scope","$stateParams","$state","$http","Legacy",function(a,b,c,d,e){b.nonprofitUid?e.nonprofit(b.nonprofitUid,function(a){var b=a.slug;c.transitionTo("root.nonprofit",{slug:b})},function(){c.transitionTo("root.home"),toastr.error("Essa ong não existe")}):b.projectUid?e.project(b.projectUid,function(a){var b=a.slug;c.transitionTo("root.project",{slug:b})},function(){c.transitionTo("root.home"),toastr.error("Este ato não existe")}):b.slug&&e.users(b.slug,function(a){a.type===constants.VOLUNTEER?c.transitionTo("root.volunteer",{slug:b.slug}):a.type===constants.NONPROFIT&&c.go("root.nonprofit",{slug:b.slug})},function(){toastr.error("Não existe;")})}]),toastr.options.closeButton=!0,toastr.options.hideEasing="linear";var app=angular.module("atadosApp");app.controller("LoginCtrl",["$scope","$rootScope","Auth","Facebook",function(a,b,c){a.showForgotPassword=!1,a.remember=!0,a.wrongCredentials=!1,a.$watch("forgotEmail",function(b){b?c.isEmailUsed(b,function(){a.resetPasswordForm.forgotEmail.alreadyUsed=!1,a.resetPasswordForm.forgotEmail.$invalid=!0},function(){a.resetPasswordForm.forgotEmail.alreadyUsed=!0,a.resetPasswordForm.forgotEmail.$invalid=!1}):a.resetPasswordForm.forgotEmail.$invalid=!0}),a.login=function(){a.password&&a.email&&c.login({username:a.email,password:a.password,remember:a.remember},function(){c.getCurrentUser(function(a){b.$emit("userLoggedIn",a)},function(a){toastr.error(a)})},function(){a.wrongCredentials=!0})},a.forgotPassword=function(){a.showForgotPassword=!a.showForgotPassword},a.resetPassword=function(){c.resetPassword(a.forgotEmail,function(){toastr.info("Agora veja seu email para receber sua nova senha. Depois você pode mudar para uma senha da sua preferência.")},function(){toastr.error("Sua senha não pode ser mandada. Por favor mande um email para o administrador marjori@atados.com.br")})}}]);var app=angular.module("atadosApp");app.controller("RootCtrl",["$scope","$rootScope","$state","Auth",function(a,b,c,d){a.getLoggedUser=d.getUser,a.$watch("getLoggedUser()",function(d){a.loggedUser=d,b.modalInstance&&b.modalInstance.close(),a.loggedUser&&a.loggedUser.role===constants.NONPROFIT&&(a.loggedUser.address=a.loggedUser.user.address,a.loggedUser.causes.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png"}),a.loggedUser.projects.forEach(function(a){a.causes.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png"})}),c.transitionTo("root.nonprofitadmin"))}),b.$on("userLoggedIn",function(d,e){e&&(b.modalInstance&&b.modalInstance.close(),a.loggedUser=e,a.loggedUser.role===constants.NONPROFIT?c.transitionTo("root.nonprofitadmin"):a.loggedUser.role===constants.VOLUNTEER||toastr.error("Usuário desconhecido acabou de logar."),toastr.success("Oi! Bom te ver por aqui :)",a.loggedUser.slug))}),a.logout=function(){toastr.success("Tchau até a próxima :)",a.loggedUser.slug),a.$emit("userLoggedOut"),d.logout(),a.loggedUser=null}}]);var app=angular.module("atadosApp");app.controller("NonprofitAdminCtrl",["$scope","$state","$timeout","Restangular","Photos","$http",function(a,b,c,d,e,f){function g(a){"Voluntário"===a.status?a.statusStyle={color:"green"}:"Desistente"===a.status?a.statusStyle={color:"red"}:"Candidato"===a.status&&(a.statusStyle={color:"#0081B2"})}function h(a){a.published?a.closed?a.statusStyle={"background-color":"#db524b"}:a.closed||(a.statusStyle={"background-color":"#58b957"}):a.statusStyle={"background-color":"#f2ae43"}}function i(b){b.emailAllString="mailto:"+a.nonprofit.user.email+"?bcc=",h(b),d.one("project",b.slug).getList("volunteers",{page_size:1e3}).then(function(a){b.volunteers=a,b.volunteers.forEach(function(a){b.emailAllString+=a.email+",",a.apply.forEach(function(c){return c.project===b.slug?(a.status=c.status.name,void g(a)):void 0})})})}a.editing=!1,a.addCause=function(b){if(b.checked=!b.checked,b.checked)a.nonprofit.causes.push(b);else{var c=a.nonprofit.causes.indexOf(b);c>-1&&a.nonprofit.causes.splice(c,1)}},a.cityLoaded=!1,a.$watch("nonprofit.address.state",function(b){if(a.cityLoaded=!1,a.stateCities=[],b&&!b.citiesLoaded)d.all("cities").getList({page_size:3e3,state:b.id}).then(function(c){c.forEach(function(b){a.stateCities.push(b),b.id===a.nonprofit.address.city.id&&(a.nonprofit.address.city=b),b.active||a.cities().push(b)}),b.citiesLoaded=!0,a.cityLoaded=!0});else if(b){var c=a.cities();c.forEach(function(b){b.state.id===a.nonprofit.address.state.id&&a.stateCities.push(b)}),a.cityLoaded=!0}}),a.uploadProfileFile=function(b){if(b){var c=new FormData;c.append("file",b[0]),e.setNonprofitProfilePhoto(c,function(b){a.nonprofit.image_url=b.file,toastr.success("Logo da ONG salva com sucesso.")},function(){toastr.error("Error no servidor. Não consigo atualizar sua foto :(")})}},a.uploadCoverFile=function(b){if(b){var c=new FormData;c.append("file",b[0]),e.setNonprofitCoverPhoto(c,function(b){a.nonprofit.cover_url=b.file,toastr.success("Foto cover da ONG salva com sucesso.")},function(){toastr.error("Error no servidor. Não consigo atualizar sua foto :(")})}},a.markers=[],c(function(){if(a.loggedUser&&"VOLUNTEER"!==a.loggedUser.role){if(a.nonprofit=a.loggedUser,a.nonprofit.address.state=a.states()[a.nonprofit.address.city.state.id-1],a.nonprofit.facebook_page){var c=document.createElement("a");c.href=a.nonprofit.facebook_page,a.nonprofit.facebook_page_short=c.pathname,a.nonprofit.facebook_page_short=a.nonprofit.facebook_page_short.replace(/\//,"")}if(a.nonprofit.google_page){var d=document.createElement("a");d.href=a.nonprofit.google_page,a.nonprofit.google_page_short=d.pathname,a.nonprofit.google_page_short=a.nonprofit.google_page_short.replace(/\//,"")}if(a.nonprofit.twitter_handle){var e=document.createElement("a");e.href=a.nonprofit.google_page,a.nonprofit.twitter_handle_short=e.pathname,a.nonprofit.twitter_handle_short=a.nonprofit.twitter_handle_short.replace(/\//,"")}a.nonprofit.projects.forEach(i),a.activeProject=a.nonprofit.projects[0],a.nonprofit.user.address&&(a.nonprofit.address=a.nonprofit.user.address,a.markers.push(a.nonprofit.address),a.center=new google.maps.LatLng(a.nonprofit.address.latitude,a.nonprofit.address.longitude),a.zoom=15)}else b.transitionTo("root.home"),toastr.error("Apenas ONGs tem acesso ao Painel de Controle")},2e3),a.changeActiveProject=function(b){a.activeProject=b},a.changeVolunteerStatus=function(b,c){b.status=c,g(b),f.post(constants.api+"change_volunteer_status/",{volunteer:b.email,project:a.activeProject.slug,volunteerStatus:b.status})},a.editProject=function(a){b.transitionTo("root.project",{slug:a.slug})},a.cloneProject=function(b){f.post(constants.api+"project/"+b.slug+"/clone/").success(function(c){i(b),a.nonprofit.projects.push(c)})},a.closeOrOpenProject=function(a){a.closed=!a.closed,h(a),d.one("project",a.slug).get().then(function(b){b.closed=a.closed,delete b.nonprofit.image,delete b.nonprofit.cover,delete b.work,delete b.job,delete b.causes,delete b.skills,b.put()})},a.exportList=function(a){f.get(constants.api+"project/"+a.slug+"/export/").success(function(b){var c="data:text/csv;utf-9,"+encodeURI(b.volunteers),d=document.createElement("a");angular.element(d).attr("href",c).attr("download","Voluntários "+a.name),d.click()})},a.doneEditingNonprofit=function(b){if(a.editing){b.facebook_page=b.facebook_page_short?"http://www.facebook.com/"+b.facebook_page_short:null,b.google_page=b.google_page_short?"http://plus.google.com/"+b.google_page_short:null,b.twitter_handle=b.twitter_handle_short?"http://twitter.com/"+b.twitter_handle_short:null;var c={};angular.copy(b,c),delete c.projects,delete c.image_url,delete c.cover_url,delete c.address.state;var d=[];c.causes.forEach(function(a){d.push(a.id)}),c.causes=d,c.user.address.city=c.address.city.id,f.put(constants.api+"nonprofit/"+b.slug+"/.json",c).success(function(){toastr.success("Perfil da ONG salva!"),a.editing=!1}).error(function(){a.editing=!1,toastr.error("Problema ao salvar o perfil da ONG, por favor tente de novo")})}},a.volunteerStatusOptions=["Voluntário","Candidato","Desistente"]}]);var app=angular.module("atadosApp");app.controller("NonprofitCtrl",["$scope","$state","$stateParams","$http","Auth","Restangular",function(a,b,c,d,e,f){a.markers=[],a.activeProjects=!0,a.nonprofit={name:"",details:""},a.landing=!1,f.one("nonprofit",c.slug).get().then(function(b){a.nonprofit=b,a.nonprofit.projects.forEach(function(a){a.causes.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png"}),a.skills.forEach(function(a){a.image=constants.storage+"skill_"+a.id+".png",a.class="skill_"+a.id}),a.nonprofit.slug=a.nonprofit.user.slug,a.nonprofit.image_url="http://atadosapp.s3.amazonaws.com/"+a.nonprofit.image}),a.site.title="ONG - "+a.nonprofit.name,a.image=a.nonprofit.image_url,a.coverImage=a.nonprofit.cover_url,a.causes().forEach(function(b){a.nonprofit.causes.forEach(function(c){if(b.id===c){var d=a.nonprofit.causes.indexOf(c);a.nonprofit.causes[d]=b}})}),a.nonprofit.user.address&&(a.nonprofit.address=a.nonprofit.user.address,a.markers.push(a.nonprofit.address),a.center=new google.maps.LatLng(a.nonprofit.address.latitude,a.nonprofit.address.longitude),a.zoom=15)},function(){b.transitionTo("root.home"),toastr.error("Ong não encontrada.")}),a.getProjects=function(){return a.nonprofit.projects?a.nonprofit.projects.filter(a.activeProjects?function(a){return!(a.closed||a.deleted)}:function(a){return a.closed||a.deleted}):void 0},a.showAddVolunteerToNonprofitButton=function(){return a.loggedUser&&a.loggedUser.role===constants.VOLUNTEER},a.addVolunteerToNonprofit=function(){d.post(constants.api+"set_volunteer_to_nonprofit/",{nonprofit:a.nonprofit.id}).success(function(b){a.alreadyVolunteer="Added"===b[0]?!0:!1}).error(function(){toastr.error("Não conseguimos te adicionar a lista de voluntários da ONG :(")})},a.alreadyVolunteer=!1,a.$watch("loggedUser + $scope.nonprofit",function(){a.getLoggedUser()&&a.getLoggedUser().role===constants.VOLUNTEER&&a.nonprofit&&d.get(constants.api+"is_volunteer_to_nonprofit/?nonprofit="+a.nonprofit.id.toString()).success(function(b){a.alreadyVolunteer="YES"===b[0]?!0:!1})})}]);var app=angular.module("atadosApp");app.controller("VolunteerSignupCtrl",["$scope","$rootScope","Auth",function(a,b,c){a.$watch("slug",function(b){b?b.indexOf(" ")>=0?(a.signupForm.slug.$invalid=!0,a.signupForm.slug.hasSpace=!0):(a.signupForm.slug.hasSpace=!1,a.signupForm.slug.$invalid=!1,c.isSlugUsed(b,function(){a.signupForm.slug.alreadyUsed=!1,a.signupForm.slug.$invalid=!1},function(){a.signupForm.slug.alreadyUsed=!0,a.signupForm.slug.$invalid=!0})):(a.signupForm.slug.alreadyUsed=!1,a.signupForm.slug.hasSpace=!1,a.signupForm.slug.$invalid=!1)}),a.$watch("email",function(b){b&&c.isEmailUsed(b,function(){a.signupForm.email.alreadyUsed=!1,a.signupForm.email.$invalid=!1},function(){a.signupForm.email.alreadyUsed=!0,a.signupForm.email.$invalid=!0})}),a.$watch("password + passwordConfirm",function(){a.passwordDoesNotMatch=a.password!==a.passwordConfirm}),a.signup=function(){a.signupForm.$valid&&c.volunteerSignup({slug:a.slug,email:a.email,password:a.password},function(){c.login({username:a.email,password:a.password,remember:a.remember},function(){c.getCurrentUser(function(a){toastr.success("Oi!",a.slug),b.$emit("userLoggedIn",a)},function(a){toastr.error(a)})},function(){a.error="Usuário ou senha estão errados :("})},function(a){toastr.error(a.detail)})}}]);var app=angular.module("atadosApp");app.controller("NonprofitSignupCtrl",["$scope","$filter","$state","Auth","Photos","Restangular",function(a,b,c,d,e,f){a.nonprofit={address:{neighborhood:null,zipcode:null,addressline:null,addressnumber:null},phone:null,description:null,name:null,slug:null,details:null,user:{first_name:null,slug:null,last_name:null,email:null,password:null},facebook_page:null,google_page:null,twitter_handle:null,website:null,causes:[]},a.$watch("nonprofit.user.email",function(b){d.isEmailUsed(b,function(){a.signupForm.email.alreadyUsed=!1,a.signupForm.email.$invalid=!1},function(){a.signupForm.email.alreadyUsed=!0,a.signupForm.email.$invalid=!0})}),a.$watch("nonprofit.user.slug",function(b){b?b.indexOf(" ")>=0?(a.signupForm.slug.$invalid=!0,a.signupForm.slug.hasSpace=!0):(a.signupForm.slug.$invalid=!1,a.signupForm.slug.hasSpace=!1,d.isSlugUsed(b,function(){a.signupForm.slug.alreadyUsed=!1,a.signupForm.slug.$invalid=!1},function(){a.signupForm.slug.alreadyUsed=!0,a.signupForm.slug.$invalid=!0})):(a.signupForm.slug.alreadyUsed=!1,a.signupForm.slug.hasSpace=!1,a.signupForm.slug.$invalid=!1)}),a.cityLoaded=!1,a.$watch("nonprofit.address.state",function(b){if(a.cityLoaded=!1,a.stateCities=[],b&&!b.citiesLoaded)f.all("cities").getList({page_size:3e3,state:b.id}).then(function(c){c.forEach(function(b){a.stateCities.push(b),b.active||a.cities().push(b)}),b.citiesLoaded=!0,a.cityLoaded=!0});else if(b){var c=a.cities();c.forEach(function(b){b.state.id===a.nonprofit.address.state.id&&a.stateCities.push(b)}),a.cityLoaded=!0}}),a.$watch("password + passwordConfirm",function(){a.signupForm.password.doesNotMatch=a.password!==a.passwordConfirm,a.signupForm.password.$invalid=a.signupForm.password.doesNotMatch}),a.addCause=function(b){if(b.checked=!b.checked,b.checked)a.nonprofit.causes.push(b);else{var c=a.nonprofit.causes.indexOf(b);c>-1&&a.nonprofit.causes.splice(c,1)}},a.uploadFile=function(b){if(b){var c=new FormData;c.append("file",b[0]),e.setVolunteerPhoto(c,function(b){a.image=b.file},function(){toastr.error("Error no servidor. Não consigo atualizar sua foto :(")})}},a.signup=function(){a.nonprofit.user.password=a.password,a.facebook_page="http://facebook.com/"+a.facebook_page,d.nonprofitSignup(a.nonprofit,function(){toastr.success("Bem vinda ONG ao atados!"),c.transitionTo("root.nonprofitadmin")},function(a){toastr.error(a)})}}]);var app=angular.module("atadosApp");app.controller("ProjectCtrl",["$scope","$rootScope","$state","$stateParams","$http","Auth","Restangular","$modal","Volunteer",function(a,b,c,d,e,f,g,h,i){function j(){var b="partials/volunteerContractModal.html",c="ProjectModalCtrl";a.alreadyApplied&&(b="partials/volunteerUnapplyModal.html",c=function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}});var d=h.open({templateUrl:b,resolve:{nonprofit:function(){return a.project.nonprofit},phone:function(){return a.loggedUser.user.phone}},controller:c});d.result.then(function(b){if(b){var c=b.phone,d=b.message;a.alreadyApplied||(d&&a.loggedUser.user.email&&a.nonprofit.user.email?e.post(constants.api+"send_volunteer_email_to_nonprofit/",{message:d,volunteer:a.loggedUser.user.email,nonprofit:a.nonprofit.user.email}).success(function(){toastr.success("Email enviado com sucesso!")}).error(function(){toastr.error("Não consegui enviar email para a ONG. Por favor mande um email para resolvermos o problema: contato@atados.com.br")}):toastr.error("Não consegui enviar email para a ONG. Por favor mande um email para resolvermos o problema: contato@atados.com.br"),c&&(a.loggedUser.user.phone=c,i.save(a.loggedUser,function(){},function(){})))}e.post(constants.api+"apply_volunteer_to_project/",{project:a.project.id}).success(function(b){"Applied"===b[0]?(a.project.volunteers.push(a.loggedUser),a.alreadyApplied=!0,toastr.success("Parabéns! Você é voluntário para "+a.project.name)):(a.project.volunteers.splice(a.project.volunteers.indexOf(a.loggedUser),1),a.alreadyApplied=!1,toastr.success("Você não é mais voluntário para "+a.project.name))}).error(function(){toastr.error("Não conseguimos te atar. Por favor mande um email para resolvermos o problema: contato@atados.com.br")})},function(){console.log("Modal dismissed at: "+new Date)})}a.markers=[],a.landing=!1,g.one("project",d.slug).get().then(function(b){if(a.project=b,a.nonprofit=a.project.nonprofit,window.project=a.project,window.nonprofit=a.nonprofit,a.site.title="Ato - "+a.project.name,a.image=a.project.image_url,a.project.causes.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png"}),a.project.skills.forEach(function(a){a.image=constants.storage+"skill_"+a.id+".png"}),a.project.work){for(var c=[],d=0;3>d;d++){var e=[];c.push(e);for(var f=0;7>f;f++)e.push({checked:!1})}a.project.work.availabilities.forEach(function(a){c[a.period][a.weekday].checked=!0}),a.project.work.availabilities=c}a.causes().forEach(function(b){a.project.causes.forEach(function(c){if(b.id===c){var d=a.project.causes.indexOf(c);a.nonprofit.causes[d]=b}})}),a.project.address&&(a.markers.push(a.project.address),a.center=new google.maps.LatLng(a.project.address.latitude,a.project.address.longitude),a.zoom=15)},function(){c.transitionTo("root.home"),toastr.error("Ato não encontrado.")}),a.alreadyApplied=!1,window.scope=a,b.$on("userLoggedIn",function(){a.showApplyModal&&!a.alreadyApplied?j():a.showApplyModal=!1}),b.$on("userLoggedOut",function(){a.alreadyApplied=!1}),a.showApplyModal=!1,a.applyVolunteerToProject=function(){a.loggedUser?j():(a.openVolunteerModal(),a.showApplyModal=!0,toastr.info("Você tem que logar primeiro!"))},a.$watch("loggedUser + $scope.project",function(){a.loggedUser&&a.loggedUser.role===constants.VOLUNTEER&&a.project&&e.get(constants.api+"has_volunteer_applied/?project="+a.project.id.toString()).success(function(b){a.alreadyApplied="YES"===b[0]?!0:!1})})}]);var app=angular.module("atadosApp");app.controller("ProjectModalCtrl",["$scope","$modalInstance","nonprofit","phone",function(a,b,c,d){a.nonprofit=c,a.contractForm={},a.contractForm.phone=d,a.contractForm.message="Oi ONG! Eu quero ajudar nisso e nisso e depois nisso!",a.phoneWarningMessage="",a.ok=function(){a.contractForm.phone||a.phoneWarningMessage?b.close({phone:a.contractForm.phone,message:a.contractForm.message}):a.phoneWarningMessage="Não é obrigátorio colocar seu telefone. Mas vai ajudar muito a ONG a entrar em contato com você rapidamente. Se você quer continuar sem telefone click em Ok e você vai ser cadastrado"
},a.cancel=function(){b.dismiss("cancel")}}]);var app=angular.module("atadosApp");app.controller("ProjectNewCtrl",["$scope","$filter","$state","Auth","Restangular",function(a,b,c,d,e){a.minDate=new Date,a.ismeridian=!0,a.toggleMode=function(){a.ismeridian=!a.ismeridian},a.typeOfProject="job",c.transitionTo("root.newproject.job"),a.changeType=function(b){a.typeOfProject=b},a.project={name:"",nonprofit:a.loggedUser,slug:"",responsible:"",causes:""},a.job={address:{},skills:[],roles:[],start_date:new Date,end_date:new Date},a.work={address:{},availabilities:[],roles:[],skills:[],weekly_hours:0,can_be_done_remotely:!1},a.newRole={name:"",prerequisites:"",vacancies:0},a.removeRole=function(b,c){"job"===c?a.job.roles.splice(a.job.roles.indexOf(b),1):"work"===c&&a.work.roles.splice(a.work.roles.indexOf(b),1)},a.addRole=function(b){b&&("job"===b?(a.job.roles.push(a.newRole),a.newRole={}):"work"===b?a.work.roles.push(a.newRole):toastr.error("Problema inesperado, me desculpe!"))},a.$watch("project.slug",function(b){b?b.indexOf(" ")>=0?(a.newProjectForm.slug.$invalid=!0,a.newProjectForm.slug.hasSpace=!0):(a.newProjectForm.slug.$invalid=!1,a.newProjectForm.slug.hasSpace=!1,d.isProjectSlugUsed(b,function(){a.newProjectForm.slug.alreadyUsed=!1,a.newProjectForm.slug.$invalid=!1},function(){a.newProjectForm.slug.alreadyUsed=!0,a.newProjectForm.slug.$invalid=!0})):(a.newProjectForm.slug.alreadyUsed=!1,a.newProjectForm.slug.hasSpace=!1,a.newProjectForm.slug.$invalid=!1)});var f=function(){if(a.project.skills){a.project.skills=b("filter")(a.skills,{checked:!0});var c=0;a.project.skills.forEach(function(b){a.project.skills[c++]=b.url})}var d=e.all("roles");d.post(a.job.roles).then(function(b){a.job.roles=[],b.forEach(function(b){a.job.roles.push(b.id)}),a.project.job=a.job;var c=e.all("projects");c.post(a.project).then(function(){toastr.success("Ato criado!",a.project.name)},function(){toastr.error("Problema em criar ato :(")})})},g=function(){a.project.work=a.work};a.createProject=function(){a.project.causes=b("filter")(a.causes(),{checked:!0});var c=0;switch(a.project.causes.forEach(function(b){a.project.causes[c++]=b.url}),a.project.nonprofit=a.loggedUser.url,a.typeOfProject){case"job":f();break;case"work":g()}}}]);var app=angular.module("atadosApp");app.controller("ExplorerCtrl",["$scope","$filter",function(a,b){a.site.title="Atados - Explore",a.landing=!1,a.objects=a.search.showProjects?a.search.projects():a.search.nonprofits(),a.previousMarker=null,a.iw=new google.maps.InfoWindow,a.oms=null,a.markers=constants.markers,a.$on("gmMarkersUpdated",function(){a.map&&!a.oms&&(a.oms=new OverlappingMarkerSpiderfier(a.map),a.oms.addListener("spiderfy",function(){a.iw.close()}),a.oms.addListener("unspiderfy",function(){a.iw.close()}),a.oms.addListener("click",a.selectMarker));for(var b in a.markers)a.markers[b].setIcon(constants.notselected),a.oms.addMarker(a.markers[b])}),a.mapOptions={map:{center:constants.saoPauloCenter,zoom:constants.defaultZoom},marker:{clickable:!0,draggable:!1}},a.$watch("search.projects()",function(){a.search.showProjects&&(a.objects=a.search.projects())}),a.$watch("search.nonprofits()",function(){a.search.showProjects||(a.objects=a.search.nonprofits())}),a.$watch("search.showProjects",function(){a.objects=a.search.showProjects?a.search.projects():a.search.nonprofits()}),a.selectMarker=function(b,c){if(a.previousMarker&&(a.previousMarker.setIcon(constants.notselected),angular.element(document.querySelector("#card-"+a.previousMarker.slug)).removeClass("hover"),a.previousMarker.setZIndex(1),a.previousMarker=null),c&&!b&&(b=a.markers[c.slug]),b){var d="card-"+b.slug;a.iw.setContent(b.title),a.iw.open(constants.map,b),b.setIcon(constants.selected),angular.element(document.querySelector("#"+d)).addClass("hover"),b.setZIndex(100),a.previousMarker=b,constants.map.setCenter(b.getPosition())}},a.getMarkerOpts=function(a){return angular.extend({title:"<h4>"+a.name+"</h4><p>"+b("as_location_string")(a.address)+"</p>"},{slug:a.slug})}}]);var app=angular.module("atadosApp");app.controller("SearchCtrl",["$scope","Restangular","$http","$location","$anchorScroll","Search",function(a,b,c,d,e,f){a.search=f,a.map=constants.map,a.$watch("search.city",function(b){a.zoom=constants.defaultZoom,"Sao Paulo"===b.name?a.center=constants.saoPauloCenter:"Curitiba"===b.name?a.center=constants.curitibaCenter:"Brasilia"===b.name?a.center=constants.brasiliaCenter:0===b.id&&(a.center=null,a.zoom=1)}),a.$watch("search.cause",function(b,c){b!==c&&a.search.filter(f.query,f.cause.id,f.skill.id,f.city.id)}),a.$watch("search.skill",function(b,c){b!==c&&a.search.filter(f.query,f.cause.id,f.skill.id,f.city.id)}),a.$watch("search.city",function(b,c){b!==c&&a.search.filter(f.query,f.cause.id,f.skill.id,f.city.id)}),a.$watch("search.query",function(b,c){b!==c&&a.search.filter(f.query,f.cause.id,f.skill.id,f.city.id)}),a.getMore=function(){if(a.landing){var b={showProjects:a.search.showProjects,city:a.search.city,cause:a.search.cause,skill:a.search.skill};a.$emit("landingToExplorer",b)}a.search.showProjects?a.search.nextUrlProject()?c.get(a.search.nextUrlProject()).success(function(b){b.results.forEach(function(b){if(b.image_url){var c=b.image_url.split("?");b.nonprofit.image_url="http://atadosapp.s3.amazonaws.com/"+b.nonprofit.image+"?"+c}b.causes.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png",a.class="cause_"+a.id}),a.search.projects().push(b)}),a.search.setNextUrlProject(b.next)}).error(function(){toastr.error("Erro ao buscar mais atos do servidor")}):toastr.error("Não conseguimos achar mais atos. Tente mudar os filtros."):a.search.nextUrlNonprofit()?c.get(a.search.nextUrlNonprofit()).success(function(b){b.results.forEach(function(b){b.address=b.user.address;var c=[];b.causes.forEach(function(a){var b={};b.image=constants.storage+"cause_"+a+".png",b.class="cause_"+a,c.push(b)}),b.causes=c,a.search.nonprofits().push(b)}),a.search.setNextUrlNonprofit(b.next)}).error(function(){toastr.error("Erro ao buscar mais ONGs do servidor")}):toastr.error("Não conseguimos achar mais ONGs. Tente mudar os filtros.")}}]);var app=angular.module("atadosApp");app.controller("VolunteerCtrl",["$scope","$state","$stateParams","Restangular",function(a,b,c,d){if(c.slug){a.site.title="Voluntário - "+c.slug;var e=function(a){a.causes.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png",a.class="cause_"+a.id}),a.skills.forEach(function(a){a.image=constants.storage+"skill_"+a.id+".png",a.class="skill_"+a.id}),a.nonprofit.image_url="http://atadosapp.s3.amazonaws.com/"+a.nonprofit.image,a.nonprofit.slug=a.nonprofit.user.slug},f=function(b){var c=[];b.causes.forEach(function(b){b=a.causes()[b],c.push(b),b.image=constants.storage+"cause_"+b.id+".png",b.class="cause_"+b.id}),b.causes=c,b.address=b.user.address},g=function(b){a.image=b.image_url;var c=[];b.causes.forEach(function(b){b=a.causes()[b],b.checked=!0,c.push(b)}),b.causes=c;var d=[];b.skills.forEach(function(b){b=a.skills()[b],d.push(b)}),b.skills=d,b.projects.forEach(function(a){e(a)}),b.nonprofits.forEach(function(a){f(a)})};d.one("volunteers",c.slug).get().then(function(b){a.volunteer=b,g(a.volunteer)},function(){b.transitionTo("root.home"),toastr.error("Voluntário não encontrado")})}else b.transitionTo("root.home"),toastr.error("Voluntário não encontrado")}]);var app=angular.module("atadosApp");app.controller("VolunteerEditCtrl",["$scope","$filter","Auth","Photos","$http","Restangular",function(a,b,c,d,e,f){a.$watch("loggedUser",function(b){b&&(a.volunteer=b,a.volunteer.address=b.address?b.address:{},a.volunteer.address.city&&(a.volunteer.address.state=a.states()[a.volunteer.address.city.state.id-1]))}),a.addCause=function(b){if(b.checked=!b.checked,b.checked)a.volunteer.causes.push(b);else{var c=a.volunteer.causes.indexOf(b);c>-1&&a.volunteer.causes.splice(c,1)}},a.addSkill=function(b){if(b.checked=!b.checked,b.checked)a.volunteer.skills.push(b);else{var c=a.volunteer.skills.indexOf(b);c>-1&&a.volunteer.skills.splice(c,1)}},a.cityLoaded=!1,a.$watch("volunteer.address.state",function(b){if(a.cityLoaded=!1,a.stateCities=[],b&&!b.citiesLoaded)f.all("cities").getList({page_size:3e3,state:b.id}).then(function(c){c.forEach(function(b){a.stateCities.push(b),a.volunteer.address.city&&b.id===a.volunteer.address.city.id&&(a.volunteer.address.city=b),b.active||a.cities().push(b)}),b.citiesLoaded=!0,a.cityLoaded=!0});else if(b){var c=a.cities();c.forEach(function(b){b.state.id===a.volunteer.address.state.id&&a.stateCities.push(b)}),a.cityLoaded=!0}}),a.uploadProfileFile=function(b){if(b){var c=new FormData;c.append("file",b[0]),d.setVolunteerPhoto(c,function(b){a.volunteer.image_url=b.file,toastr.success("Foto do voluntário salva com sucesso.")},function(){toastr.error("Error no servidor. Não consigo atualizar sua foto :(")})}},a.saveVolunteer=function(){var b={};angular.copy(a.volunteer,b),delete b.projects,delete b.nonprofits;var d=[];b.causes.forEach(function(a){d.push(a.id)}),b.causes=d;var f=[];b.skills.forEach(function(a){f.push(a.id)}),b.skills=f,b.address.city=b.address.city.id,b.user.address=b.address,window.copy=b,e.put(constants.api+"volunteers/"+b.slug+"/.json",b).success(function(){toastr.success("Perfil salvo!",a.volunteer.slug)}).error(function(){toastr.error("Problema em salvar seu perfil :(")}),a.password&&a.password===a.passwordConfirm&&c.changePassword({email:a.volunteer.user.email,password:a.password},function(){toastr.success("Senha nova salva",a.volunteer.slug)},function(){toastr.error("Não conseguimos atualizar sua senha :(")})},a.$watch("causes + volunteer.causes",function(){a.causes()&&a.volunteer&&a.volunteer.causes.forEach(function(b){for(var c=0;c<a.causes().length;++c){var d=a.causes()[c];if(d.url===b){d.checked=!0;break}}})}),a.$watch("skills + volunteer.skills",function(){a.skills&&a.volunteer&&a.volunteer.skills&&a.volunteer.skills.forEach(function(b){for(var c=0;c<a.skills.length;++c){var d=a.skills[c];if(d.url===b){d.checked=!0;break}}})}),a.$watch("volunteer.user.email",function(b){a.loggedUser&&(b&&b!==a.loggedUser.user.email?a.volunteerForm.email.alreadyUsed=!1:b!==a.loggedUser.user.email&&c.isEmailUsed(b,function(){a.volunteerForm.email.alreadyUsed=!1,a.volunteerForm.email.$invalid=!1},function(){a.volunteerForm.email.alreadyUsed=!0,a.volunteerForm.email.$invalid=!0}))}),a.uploadFile=function(b){if(b){var c=new FormData;c.append("file",b[0]),d.setVolunteerPhoto(c,function(b){a.image=b.file},function(){toastr.error("Error no servidor. Não consigo atualizer sua foto :(")})}},a.$watch("password + passwordConfirm",function(){a.volunteerForm.password.doesNotMatch=a.password!==a.passwordConfirm,a.volunteerForm.password.$invalid=a.volunteerForm.password.doesNotMatch})}]);var app=angular.module("atadosApp");app.controller("VolunteerModalCtrl",["$scope","$rootScope","Facebook","Auth",function(a,b,c,d){function e(a){d.facebookAuth(a,function(a){b.$emit("userLoggedIn",a)},function(){toastr.error("Houve um error no servidor tentando logar com sua conta no Facebook.")})}a.loginActive=!0,a.$watch("loginActive",function(b){a.facebookState=b?"Entrar ":"Criar conta "}),a.$watch(function(){return c.isReady()},function(){a.facebookReady=!0}),a.facebookAuth=function(){c.getLoginStatus(function(a){"connected"!==a.status?c.login(function(b){"connected"===b.status?e(b.authResponse):"not_authorized"===a.status},{scope:"email"}):a.authResponse?e(a.authResponse):toastr.error("Could not get facebook credentials")})}}]);