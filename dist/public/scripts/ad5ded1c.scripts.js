"use strict";var app=angular.module("atadosApp",["restangular","ui.router","ui.bootstrap","AngularGM","ezfb"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){a.state("root",{url:"","abstract":!0,templateUrl:"/partials/root.html",controller:"RootCtrl",resolve:{loggedUser:["Auth",function(a){return a.getCurrentUser()}]}}).state("root.home",{url:"/",templateUrl:"/partials/home.html",controller:"HomeCtrl"}).state("root.about",{url:"/sobre",templateUrl:"/partials/about.html",controller:"AboutCtrl"}).state("root.404",{url:"/ops",templateUrl:"/partials/404.html"}).state("root.explore",{url:"/explore",templateUrl:"/partials/explore.html",controller:"ExplorerCtrl"}).state("root.volunteer",{url:"/voluntario/:slug",templateUrl:"/partials/volunteerProfile.html",controller:"VolunteerCtrl",resolve:{volunteer:["Volunteer","$stateParams",function(a,b){return a.get(b.slug)}]}}).state("root.volunteeredit",{url:"/editar",templateUrl:"/partials/volunteerEdit.html",controller:"VolunteerEditCtrl"}).state("root.nonprofit",{url:"/ong/:slug",templateUrl:"/partials/nonprofitProfile.html",controller:"NonprofitCtrl",resolve:{nonprofit:["Nonprofit","$stateParams",function(a,b){return a.get(b.slug)}]}}).state("root.nonprofitadmin",{url:"/controle/:slug",templateUrl:"/partials/nonprofitAdminPanel.html",controller:"NonprofitAdminCtrl"}).state("root.nonprofitsignup",{url:"/cadastro/ong",templateUrl:"/partials/nonprofitSignup.html",controller:"NonprofitSignupCtrl",resolve:{}}).state("root.project",{url:"/ato/:slug",templateUrl:"/partials/projectPage.html",controller:"ProjectCtrl",resolve:{project:["Project","$stateParams",function(a,b){return a.get(b.slug)}]}}).state("root.newproject",{url:"/cadastro/ato",templateUrl:"/partials/projectNew.html",controller:"ProjectNewCtrl"}).state("root.editproject",{url:"/editar/ato/:slug",templateUrl:"/partials/projectEdit.html",controller:"ProjectEditCtrl"}).state("legacynonprofit",{url:"/site/instituicoes/:nonprofitUid/profile",controller:"LegacyCtrl"}).state("legacyVolunteerOrNonprofit",{url:"/site/users/:slug",controller:"LegacyCtrl"}).state("legacyproject",{url:"/site/ato/:projectUid",controller:"LegacyCtrl"}),b.otherwise("/ops"),c.html5Mode(!0).hashPrefix("!")}]),app.config(["$httpProvider",function(a){var b=["$location","$q",function(a,b){function c(a){return a}function d(a){return 401===a.status?b.reject(a):403===a.status?($.removeCookie(constants.accessTokenCookie),$.removeCookie(constants.csrfCookie),$.removeCookie(constants.sessionIdCookie),b.reject(a)):b.reject(a)}return function(a){return a.then(c,d)}}];a.responseInterceptors.push(b)}]),app.config(["$FBProvider",function(a){a.setLocale(constants.locale),a.setInitParams({appId:constants.facebookClientId})}]),app.config(["RestangularProvider",function(a){a.setBaseUrl(constants.api),a.setDefaultHttpFields({cache:!0}),a.setRequestSuffix("/?format=json"),a.setRestangularFields({id:"slug"}),a.setResponseExtractor(function(a,b){if("getList"===b){var c=a.results;return c._resultmeta={count:a.count,next:a.next,previous:a.previous},c}return a})}]);var constants={devApi:"http://www.atadoslocal.com.br:8000/v1/",devAuthApi:"http://www.atadoslocal.com.br:9000/auth/client",devStorage:"http://www.atadoslocal.com.br:8000/static/images/",prodApi:"https://api.atados.com.br/v1/",prodAuthApi:"https://www.atados.com.br/auth/client",prodStorage:"https://s3-sa-east-1.amazonaws.com/atadosapp/images/",facebookClientId:"430973993601792",locale:"pt_BR",accessTokenCookie:"access_token",csrfCookie:"csrftoken",sessionIdCookie:"sessionid",grantType:"password",page_size:30,active_cities:4,static_page_size:300,weekdays:[{1:"Segunda"},{2:"Terça"},{3:"Quarta"},{4:"Quinta"},{5:"Sexta"},{6:"Sabado"},{7:"Domingo"}],periods:[{0:"Manha"},{1:"Tarde"},{2:"Noite"}],markers:[],map:null,saoPauloCenter:new google.maps.LatLng(-23.5505199,-46.6333094),curitibaCenter:new google.maps.LatLng(-25.4808762,-49.3044253),brasiliaCenter:new google.maps.LatLng(-15.79211,-47.897751),defaultZoom:11,VOLUNTEER:"VOLUNTEER",NONPROFIT:"NONPROFIT"};constants.api=constants.prodApi,constants.authApi=constants.prodAuthApi,constants.storage=constants.prodStorage,constants.selected=constants.storage+"heart.png",constants.notselected=constants.storage+"blue.png";var app=angular.module("atadosApp");app.directive("removerole",function(){return{restrict:"E",template:'<button type="destroy" ng-click="removeRole(role, "work")"><i class="fa fa-trash-o"></i></button>'}}),app.directive("button",function(){return{restrict:"E",compile:function(a,b){"submit"===b.type?a.addClass("btn-primary"):"destroy"===b.type?a.addClass("destroy"):b.type&&a.addClass("btn-"+b.type),b.size&&a.addClass("btn-"+b.size)}}}),app.directive("button-facebook",function(){return{restrict:"E"}}),app.directive("projectCard",function(){return{restrict:"E",transclude:!0,templateUrl:"/partials/projectCard.html"}}),app.directive("depoimento",function(){return{restrict:"E",transclude:!0,templateUrl:"/partials/depoimento.html"}}),app.directive("atadosSearch",function(){return{restrict:"E",templateUrl:"/partials/search.html",controller:"SearchCtrl"}}),app.directive("nonprofitCard",function(){return{restrict:"E",transclude:!0,templateUrl:"/partials/nonprofitCard.html"}}),app.directive("phone",function(){return{restrict:"E",scope:{number:"@"},template:'<p><i class="fa fa-phone"></i> {{number}}</p>'}}),app.directive("phoneInput",function(){return{restrict:"E",scope:{object:"=object",form:"=form"},templateUrl:"/partials/phoneInput.html",link:function(){$("#phoneInput").mask("(99) 9999?9-9999")}}}),app.directive("email",function(){return{restrict:"E",scope:{email:"@"},template:'<p><i class="fa fa-laptop"></i> {{email}}</p>'}}),app.directive("contactatados",function(){return{restrict:"E",scope:{},template:"<p>Entre em contato clicando abaixo no canto direito se estiver tendo problemas.</p>"}}),app.directive("doubtAtados",function(){return{restrict:"E",scope:{},template:"<p>Entre em contato clicando abaixo no canto direito se estiver com dúvidas.</p>"}}),app.directive("backgroundImg",function(){return function(a,b,c){var d=c.backgroundImg;b.css({"background-image":"url("+d+")","background-size":"cover"})}}),app.directive("imgCropped",function(){return{restrict:"E",replace:!0,scope:{src:"@",selected:"&"},link:function(a,b){var c,d=function(){c&&(c.next().remove(),c.remove(),c=void 0)};a.$watch("src",function(e){d(),e&&(b.after("<img />"),c=b.next(),c.attr("src",e),$(c).Jcrop({trackDocument:!0,onSelect:function(b){a.$apply(function(){a.selected({cords:b})})}}))}),a.$on("$destroy",d)}}});var app=angular.module("atadosApp");app.filter("as_location_string",function(){return function(a){if(!a)return"Não tem endereço.";if(0===a.city)return a.city_state;var b=a.addressline+", ";return a.addressnumber&&(b+=a.addressnumber+" - "),a.addressline2&&(b+=a.addressline2+" - "),a.neighborhood&&(b+=a.neighborhood+" - "),a.city_state&&(b+=a.city_state),a.zipcode&&(b+=" - "+a.zipcode),b}}),app.filter("newlines",["$sce",function(a){return function(b){return b?a.trustAsHtml(b.replace(/\n/g,"<br/>")):void 0}}]),app.filter("noHTML",function(){return function(a){return a?a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;"):void 0}});var app=angular.module("atadosApp");app.controller("AboutCtrl",["$scope",function(a){a.site.title="Atados - Sobre",a.team=[{name:"André Cervi",image:"https://fbcdn-profile-a.akamaihd.net/hprofile-ak-ash2/c205.44.550.550/s160x160/417055_10152269035845293_1847417011_n.jpg",where:"Atados São Paulo",description:"Blah blah"},{name:"André Cervi",image:"https://fbcdn-profile-a.akamaihd.net/hprofile-ak-ash2/c205.44.550.550/s160x160/417055_10152269035845293_1847417011_n.jpg",where:"Atados São Paulo",description:"Blah blah"}]}]);var app=angular.module("atadosApp");app.controller("AppCtrl",["$scope","$rootScope","$modal","$state","$location","$anchorScroll","Site","Search",function(a,b,c,d,e,f,g,h){a.site=g,a.search=h,b.modalInstance=null,a.storage=constants.storage,a.causes=g.causes,a.skills=g.skills,a.cities=g.cities,a.states=g.states,a.numbers=g.numbers,a.citySearch=function(b){a.cities().forEach(function(c){return c.name===b?(a.search.city=c,e.hash("top"),void f()):void 0})},a.siteSearch=function(){a.search.query=a.search.landingQuery,a.search.landingQuery="",d.transitionTo("root.explore")},a.openLogin=function(a){b.modalInstance=c.open({templateUrl:"/partials/loginModal.html",controller:["$scope",function(b){b.volunteerActive="volunteer"===a?!0:!1}]})},a.openTermsModal=function(){b.modalInstance=c.open({templateUrl:"/partials/termsModal.html"})},b.closeNonprofitLoginModal=function(){b.modalInstance.close()}}]);var app=angular.module("atadosApp");app.factory("Auth",["$http","Cookies","Cleanup",function(a,b,c){function d(b){b&&(a.defaults.headers.common.Authorization="Bearer "+b)}return{facebookAuth:function(c,e,f){a.post(constants.api+"facebook/",c).success(function(a){d(a.access_token),b.set(constants.accessTokenCookie,a.access_token),e(a.user)}).error(f)},getCurrentUser:function(e){return e||(e=b.get(constants.accessTokenCookie)),e?(d(e),a.get(constants.api+"current_user/?id="+(new Date).getTime()).then(function(a){return c.currentUser(a.data),a.data})):void 0},resetPassword:function(b,c,d){a.post(constants.api+"password_reset/",{email:b}).success(function(){c()}).error(d)},changePassword:function(b,c,d){a.put(constants.api+"change_password/",b).success(function(){c()}).error(d)},isEmailUsed:function(b,c){b&&a.get(constants.api+"check_email/?email="+b+"?id="+(new Date).getTime()).success(c)},isSlugUsed:function(b,c){a.get(constants.api+"check_slug/?slug="+b).success(c)},volunteerSignup:function(b,c,d){a.post(constants.api+"create/volunteer/",b).success(function(){c()}).error(d)},nonprofitSignup:function(b,c,d){a.post(constants.api+"create/nonprofit/",b,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(){c()}).error(d)},login:function(c,e,f){c.grant_type=constants.grantType,a.get(constants.authApi).success(function(g){c.client_id=g.id,c.client_secret=g.secret,a({method:"POST",url:constants.api+"oauth2/access_token/",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(c)}).success(function(a){d(a.access_token),c.remember&&b.set(constants.accessTokenCookie,a.access_token,{expires:30,path:"/"}),e(a)}).error(f)})},logout:function(){a.post(constants.api+"logout/"),b.delete(constants.accessTokenCookie),delete a.defaults.headers.common.Authorization}}}]);var app=angular.module("atadosApp");app.factory("Cleanup",["$http","$q","Site","Restangular",function(a,b,c,d){var e=function(a){"Voluntário"===a.status?a.statusStyle={color:"green"}:"Desistente"===a.status?a.statusStyle={color:"red"}:"Candidato"===a.status?a.statusStyle={color:"#0081B2"}:"Ex-Voluntário"===a.status&&(a.statusStyle={color:"black"})},f=function(a){a.published?a.closed?a.statusStyle={"background-color":"#db524b"}:a.closed||(a.statusStyle={"background-color":"#58b957"}):a.statusStyle={"background-color":"#f2ae43"}},g=function(a,b){a.emailAllString="mailto:"+b.user.email+"?bcc=",f(a),d.one("project",a.slug).getList("volunteers",{page_size:1e3}).then(function(b){a.volunteers=b,a.volunteers.forEach(function(b){a.emailAllString+=b.email+",",d.all("applies").getList({project_slug:a.slug,volunteer_slug:b.slug}).then(function(a){b.status=a[0].status.name,e(b)})})})},h=function(a){if(a){var b=[];return a.forEach(function(a){var d={};d.id=c.causes()[a].id,d.name=c.causes()[a].name,d.class=c.causes()[a].class,d.image=c.causes()[a].image,d.checked=!0,b.push(d)}),b}},i=function(a){if(a){var b=[];return a.forEach(function(a){var d={};d.id=c.skills()[a].id,d.name=c.skills()[a].name,d.class=c.skills()[a].class,d.image=c.skills()[a].image,d.checked=!0,b.push(d)}),b}};return{currentUser:function(b){b&&(b.causes=h(b.causes),b.skills=i(b.skills),b.role===constants.NONPROFIT&&b.projects&&b.projects.forEach(function(a){a.causes=h(a.causes),a.skills=i(a.skills)}),b.address=b.user.address,b.address&&b.address.city&&a.get(constants.api+"cities/"+b.address.city+"/").success(function(a){b.address.city=a,b.address.city&&(b.address.state=c.states()[b.address.city.state.id-1])}))},volunteer:function(a){a.causes=h(a.causes),a.skills=i(a.skills),a.projects.forEach(function(a){a.causes=h(a.causes),a.skills=i(a.skills),a.nonprofit.image_url="https://atadosapp.s3.amazonaws.com/"+a.nonprofit.image,a.nonprofit.slug=a.nonprofit.user.slug}),a.nonprofits.forEach(function(a){a.causes=h(a.causes),a.address=a.user.address,a.volunteers_numbers=a.volunteers.length})},nonprofitForAdmin:function(a){if(a.facebook_page){var b=document.createElement("a");b.href=a.facebook_page,a.facebook_page_short=b.pathname,a.facebook_page_short=a.facebook_page_short.replace(/\//,"")}if(a.google_page){var c=document.createElement("a");c.href=a.google_page,a.google_page_short=c.pathname,a.google_page_short=a.google_page_short.replace(/\//,"")}if(a.twitter_handle){var d=document.createElement("a");d.href=a.google_page,a.twitter_handle_short=d.pathname,a.twitter_handle_short=a.twitter_handle_short.replace(/\//,"")}a.projects.forEach(function(b){g(b,a)})},nonprofit:function(a){a.projects&&a.projects.forEach(function(a){a.causes=h(a.causes),a.skills=i(a.skills),a.nonprofit.slug=a.nonprofit.user.slug,a.nonprofit.image_url="https://atadosapp.s3.amazonaws.com/"+a.nonprofit.image})},adminProject:g,project:function(a){if(a.causes=h(a.causes),a.skills=i(a.skills),a.work){for(var b=[],c=0;3>c;c++){var d=[];b.push(d);for(var e=0;7>e;e++)d.push({checked:!1})}a.work.availabilities.forEach(function(a){b[a.period][a.weekday].checked=!0}),a.work.availabilities=b}}}}]);var app=angular.module("atadosApp");app.factory("Cookies",function(){return{get:function(a){return $.cookie(a)},getAll:function(){return $.cookie()},set:function(a,b,c){return $.cookie(a,b,c)},"delete":function(a){return $.removeCookie(a)}}});var app=angular.module("atadosApp");app.controller("HomeCtrl",["$scope","$sce",function(a,b){a.site.title="Atados - Juntando Gente Boa",a.depoimentos=[{quote:"Atar-se a alguém é de fato um ato de coragem  e essa é uma qualidade que não falta nos corações de quem é do Atados. Grande exemplo para aqueles que nasceram incomodados. Se voce é um tipo desses, experimente atar-se e nunca mais será o mesmo. Seja uma cartinha toda semana, um dia no asilo ou uma festa com gente de várias nações, viva a experiência!",name:"Talyta Santos",where:b.trustAsHtml('Funcionária da <a href="http://www.boehringer-ingelheim.com.br/" target="_blank"><strong> Boehringer</strong></a>'),image:"talyta.jpg"},{quote:"O Atados é um grupo de pessoas que quer mudar pessoas indignadas, que se juntaram para propiciar a outros novas possibilidades de ver e viver. Pessoas que acreditam que toda nova experiência e transformadora, e que querem tornar acessíveis diferentes formas de conhecer e de encontrar com o outro.",name:"Marcela Aruda",where:b.trustAsHtml('Voluntária da <a ui-sref="root.nonprofit({slug: "mudacoletivo"})" target="_blank"><strong> Muda Coletivo</strong></a>'),image:"marcela.jpg"},{quote:"Quando decidimos nos cadastrar no site sabíamos que lidaríamos com o mundo virtual, ou seja nada de contato pessoal. A grande surpresa é que essa relação passou do virtual para o real é como se vocês tivessem pulado da tela para trabalhar aqui do nosso lado e hoje somos amigos.",name:"Dayse",where:b.trustAsHtml('Funcionária da ONG <a ui-sref="root.nonprofit({slug: "parceiros"})" target="_blank"><strong> Monte Azul</strong></a>'),image:"dayse.jpg"}]}]);var app=angular.module("atadosApp");app.controller("LandingCtrl",["$scope","$rootScope",function(a,b){b.explorerView=!1,a.site.title="Atados - Juntando Gente Boa",a.landing=!0,a.selectMarker=function(a,b){angular.element(document.querySelector("#card-"+b.slug)).addClass("hover")},a.removeMarker=function(a,b){angular.element(document.querySelector("#card-"+b.slug)).removeClass("hover")}}]);var app=angular.module("atadosApp");app.factory("Legacy",["$http",function(a){return{nonprofit:function(b,c,d){a.get(constants.api+"legacy_to_slug/nonprofit/?uid="+b).success(c).error(d)},project:function(b,c,d){a.get(constants.api+"legacy_to_slug/project/?uid="+b).success(c).error(d)},users:function(b,c,d){a.get(constants.api+"slug_role/?slug="+b).success(c).error(d)}}}]);var app=angular.module("atadosApp");app.controller("LegacyCtrl",["$scope","$stateParams","$state","$http","Legacy",function(a,b,c,d,e){b.nonprofitUid?e.nonprofit(b.nonprofitUid,function(a){var b=a.slug;c.transitionTo("root.nonprofit",{slug:b})},function(){c.transitionTo("root.home"),toastr.error("Essa ong não existe")}):b.projectUid?e.project(b.projectUid,function(a){var b=a.slug;c.transitionTo("root.project",{slug:b})},function(){c.transitionTo("root.home"),toastr.error("Este ato não existe")}):b.slug&&e.users(b.slug,function(a){a.type===constants.VOLUNTEER?c.transitionTo("root.volunteer",{slug:b.slug}):a.type===constants.NONPROFIT&&c.go("root.nonprofit",{slug:b.slug})},function(){toastr.error("Não existe;")})}]),toastr.options.closeButton=!0,toastr.options.hideEasing="linear";var app=angular.module("atadosApp");app.controller("LoginCtrl",["$scope","$rootScope","Auth",function(a,b,c){a.showForgotPassword=!1,a.remember=!0,a.wrongCredentials=!1,a.$watch("forgotEmail",function(b){b?c.isEmailUsed(b,function(b){a.resetPasswordForm.forgotEmail.alreadyUsed=b.alreadyUsed,a.resetPasswordForm.forgotEmail.$invalid=!b.alreadyUsed}):a.resetPasswordForm.forgotEmail.$invalid=!0}),a.login=function(){a.password&&a.email&&c.login({username:a.email,password:a.password,remember:a.remember},function(a){c.getCurrentUser(a.access_token).then(function(a){b.$emit("userLoggedIn",a)},function(a){toastr.error(a)})},function(){a.wrongCredentials=!0})},a.forgotPassword=function(){a.showForgotPassword=!a.showForgotPassword},a.resetPassword=function(){c.resetPassword(a.forgotEmail,function(){toastr.info("Agora veja seu email para receber sua nova senha. Depois você pode mudar para uma senha da sua preferência.")},function(){toastr.error("Sua senha não pode ser mandada. Por favor mande um email para o administrador marjori@atados.com.br")})}}]);var app=angular.module("atadosApp");app.factory("Photos",["$http","$FB",function(a,b){return{getFacebookPhoto:function(c,d){b.getLoginStatus(function(b){"connected"===b.status&&(b.authResponse?(b.authResponse.getPhoto=!0,a.post(constants.api+"facebook/",b.authResponse).success(function(a){c(a.user.image_url)}).error(d)):(toastr.error("Could not get facebook credentials"),d()))})},setVolunteerPhoto:function(b,c,d){a.post(constants.api+"upload_volunteer_image/",b,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(c).error(d)},setProjectPhoto:function(b,c,d,e){a.post(constants.api+"upload_project_image/?id="+c,b,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(d).error(e)},setNonprofitProfilePhoto:function(b,c,d){a.post(constants.api+"upload_nonprofit_profile_image/",b,{headers:{"Content-Type":void 0},transformRequest:angular.indenty}).success(c).error(d)},setNonprofitCoverPhoto:function(b,c,d){a.post(constants.api+"upload_nonprofit_cover_image/",b,{headers:{"Content-Type":void 0},transformRequest:angular.indenty}).success(c).error(d)}}}]);var app=angular.module("atadosApp");app.controller("RootCtrl",["$scope","$rootScope","$state","Auth","loggedUser",function(a,b,c,d,e){a.loggedUser=e,b.modalInstance&&b.modalInstance.close(),a.loggedUser&&a.loggedUser.role===constants.NONPROFIT&&(a.loggedUser.address=a.loggedUser.user.address,a.loggedUser.causes.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png"}),a.loggedUser.projects.forEach(function(a){a.causes.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png"})})),b.$on("userLoggedIn",function(c,d){d&&(b.modalInstance&&b.modalInstance.close(),a.loggedUser=d,toastr.success("Oi! Bom te ver por aqui :)",a.loggedUser.slug))}),b.explorerView=!1,a.logout=function(){toastr.success("Tchau até a próxima :)",a.loggedUser.slug),a.$emit("userLoggedOut"),d.logout(),a.loggedUser=null,c.transitionTo("root.home")}}]);var app=angular.module("atadosApp");app.factory("Site",["Restangular","$http",function(a,b){var c=[],d=[],e=[],f=[],g={},h=function(){b.get(constants.api+"numbers/").success(function(a){a.projects?a.volunteers?a.nonprofits||(a.nonprofits=0):a.volunteers=0:a.projects=0,g=a})},i=function(){a.all("causes").getList({page_size:constants.static_page_size}).then(function(a){c=a,c.forEach(function(a){a.checked=!1,a.image=constants.storage+"cause_"+a.id+".png",a.class="cause_"+a.id}),c.splice(0,0,{name:"Todas Causas",id:"","class":"cause_0"})},function(){console.error("Não consegui pegar as causas do servidor.")})},j=function(){a.all("skills").getList({page_size:constants.static_page_size}).then(function(a){d=a,d.forEach(function(a){a.image=constants.storage+"skill_"+a.id+".png",a.class="skill_"+a.id}),d.splice(0,0,{name:"Todas Habilidades",id:""})},function(){console.error("Não consegui pegar as habilidades do servidor.")})},k=function(){b.get(constants.api+"active_cities/").success(function(a){e=a,e.splice(0,0,{name:"Todas Cidades",id:"",active:!0,state:0})}).error(function(){console.error("Não consegui pegar as cidades do servidor.")})},l=function(){a.all("states").getList({page_size:constants.static_page_size}).then(function(a){f=a},function(){console.error("Não consegui pegar os estados do servidor.")})};return i(),j(),k(),l(),h(),{name:"Atados - Juntando Gente Boa",title:"Atados - Juntando Gente Boa",contactEmail:"contato@atados.com.br",copyright:"Atados, "+(new Date).getFullYear(),termsOfService:function(){},privacy:function(){},team:[{name:"Marjori Pomarole",email:"marjori@atados.com.br",photo:"URL here",description:"Hi I am the programmer",facebook:"marjoripomarole"}],causes:function(){return c},skills:function(){return d},cities:function(){return e},states:function(){return f},numbers:function(){return g}}}]);var app=angular.module("atadosApp");app.factory("Nonprofit",["Restangular","$state","$stateParams","Cleanup",function(a,b,c,d){return{get:function(e){return a.one("nonprofit",e).get().then(function(a){return a.published?(d.nonprofit(a),a):(b.transitionTo("root.home"),void toastr.error("ONG ainda não foi aprovada. Se isso é um erro entre em contato por favor."))},function(){b.transitionTo("root.home"),toastr.error("ONG não existe.",c.slug)})}}}]);var app=angular.module("atadosApp");app.controller("NonprofitAdminCtrl",["$scope","$http","$state","$stateParams","$timeout","Restangular","Photos","Cleanup",function(a,b,c,d,e,f,g,h){function i(a){"Voluntário"===a.status?a.statusStyle={color:"green"}:"Desistente"===a.status?a.statusStyle={color:"red"}:"Candidato"===a.status?a.statusStyle={color:"#0081B2"}:"Ex-Voluntário"===a.status&&(a.statusStyle={color:"black"})}function j(a){a.published?a.closed?a.statusStyle={"background-color":"#db524b"}:a.closed||(a.statusStyle={"background-color":"#58b957"}):a.statusStyle={"background-color":"#f2ae43"}}a.editing=!1,a.nonprofitCauses=[],a.addCause=function(a){a.checked=!a.checked},a.uploadProfileFile=function(b){if(b){var c=new FormData;c.append("file",b[0]),g.setNonprofitProfilePhoto(c,function(b){a.nonprofit.image_url=b.file,toastr.success("Logo da ONG salva com sucesso.")},function(){toastr.error("Error no servidor. Não consigo atualizar sua foto :(")})}},a.uploadCoverFile=function(b){if(b){var c=new FormData;c.append("file",b[0]),g.setNonprofitCoverPhoto(c,function(b){a.nonprofit.cover_url=b.file,toastr.success("Foto cover da ONG salva com sucesso.")},function(){toastr.error("Error no servidor. Não consigo atualizar sua foto :(")})}},a.$watch("loggedUser",function(e){!e||e&&e.role===constants.VOLUNTEER&&!e.user.is_staff||(e.role===constants.VOLUNTEER&&e.user.is_staff?b.get(constants.api+"nonprofit/"+d.slug+"/").success(function(b){a.nonprofit=b,h.currentUser(a.nonprofit),h.nonprofitForAdmin(a.nonprofit),a.activeProject=a.nonprofit.projects[0]}).error(function(){c.transitionto("root.home"),toastr.error("ONG não encontrada.")}):e.role===constants.NONPROFIT&&(a.nonprofit=a.loggedUser,h.nonprofitForAdmin(a.nonprofit),a.causes().forEach(function(b){var c={};c.id=b.id,c.name=b.name,c.class=b.class,c.image=b.image,a.nonprofitCauses.push(c)}),a.nonprofit.causes.forEach(function(b){a.nonprofitCauses[b.id].checked=!0}),a.activeProject=a.nonprofit.projects[0]))}),a.changeActiveProject=function(b){a.activeProject=b},a.changeVolunteerStatus=function(c,d){c.status=d,i(c),b.post(constants.api+"change_volunteer_status/",{volunteer:c.email,project:a.activeProject.slug,volunteerStatus:c.status})},a.editProject=function(a){c.transitionTo("root.editproject",{slug:a.slug})},a.cloneProject=function(c){b.post(constants.api+"project/"+c.slug+"/clone/").success(function(b){h.adminProject(c,a.nonprofit),a.nonprofit.projects.push(b)})},a.closeOrOpenProject=function(a){a.closed=!a.closed,j(a),f.one("project",a.slug).get().then(function(b){b.closed=a.closed,delete b.nonprofit.image,delete b.nonprofit.cover,delete b.work,delete b.job,delete b.causes,delete b.skills,delete b.volunteers,b.put()})},a.exportList=function(a){b.get(constants.api+"project/"+a.slug+"/export/").success(function(b){var c="data:text/csv;utf-9,"+encodeURI(b.volunteers),d=document.createElement("a");angular.element(d).attr("href",c).attr("download","Voluntários "+a.name),d.click()})},a.doneEditingNonprofit=function(c){var d=[];if(a.nonprofitCauses.forEach(function(a){a.checked&&d.push(a.id)}),a.nonprofit.causes=d,a.editing){var e={};angular.copy(c,e),"http"!==e.website.substring(0,4)&&(e.website="http://"+e.website),e.facebook_page=e.facebook_page_short?"http://www.facebook.com/"+e.facebook_page_short:null,e.google_page=e.google_page_short?"http://plus.google.com/"+e.google_page_short:null,e.twitter_handle=e.twitter_handle_short?"http://twitter.com/"+e.twitter_handle_short:null,e.user.address.city=e.address.city.id,delete e.address,delete e.projects,delete e.image_url,delete e.cover_url,delete e.volunteers,delete e.user.address.city_state,delete e.user.address.state,b.put(constants.api+"nonprofit/"+c.slug+"/.json",e).success(function(){a.editing=!1,toastr.success("Perfil da ONG salva!")}).error(function(){a.editing=!1,toastr.error("Problema ao salvar o perfil da ONG, por favor tente de novo")})}},a.volunteerStatusOptions=["Voluntário","Candidato","Desistente","Ex-Voluntário"]}]);var app=angular.module("atadosApp");app.controller("NonprofitCtrl",["$scope","$rootScope","$state","$http","nonprofit",function(a,b,c,d,e){function f(){d.post(constants.api+"set_volunteer_to_nonprofit/",{nonprofit:a.nonprofit.id}).success(function(b){if("Added"===b[0])a.alreadyVolunteer=!0,a.nonprofit.volunteers.push(a.loggedUser),toastr.success("Parabéns você foi adicionada(o) a lista de voluntários da ONG!",a.loggedUser.slug);else{toastr.success("Você foi removida(o) da lista de voluntários da ONG. Ela vai sentir sua falta.",a.loggedUser.slug);var c=a.nonprofit.volunteers.indexOf(a.loggedUser);c>-1&&a.nonprofit.volunteers.splice(c,1),a.alreadyVolunteer=!1}}).error(function(){toastr.error("Não conseguimos te adicionar a lista de voluntários da ONG :(")})}a.landing=!1,a.nonprofit=e,a.nonprofit.address=e.user.address,a.site.title="ONG - "+a.nonprofit.name,a.activeProjects=!0,a.markers=[],a.markers.push(e.address),a.causes().forEach(function(b){a.nonprofit.causes.forEach(function(c){if(b.id===c){var d=a.nonprofit.causes.indexOf(c);a.nonprofit.causes[d]=b}})}),a.$watch("center",function(b){b&&46===b.d&&(a.center=new google.maps.LatLng(e.address.latitude,a.nonprofit.address.longitude),a.zoom=15)}),a.getProjects=function(){return e.projects?a.nonprofit.projects.filter(a.activeProjects?function(a){return!a.city_state&&a.address&&(a.city_state=a.address.city_state),!(a.closed||a.deleted)}:function(a){return!a.city_state&&a.address&&(a.city_state=a.address.city_state),a.closed||a.deleted}):void 0},a.addVolunteerToNonprofit=function(){a.loggedUser?f():(a.openVolunteerModal(),toastr.info("Você tem que logar primeiro!"))},a.alreadyVolunteer=!1,a.loggedUser&&a.loggedUser.role===constants.VOLUNTEER&&d.get(constants.api+"is_volunteer_to_nonprofit/?nonprofit="+a.nonprofit.id.toString()+"&id="+(new Date).getTime()).success(function(b){a.alreadyVolunteer="YES"===b[0]?!0:!1}),b.$on("userLoggedOut",function(){a.alreadyVolunteer=!1}),a.selectMarker=function(a,b){angular.element(document.querySelector("#card-"+b.slug)).addClass("hover")},a.removeMarker=function(a,b){angular.element(document.querySelector("#card-"+b.slug)).removeClass("hover")}}]);var app=angular.module("atadosApp");app.controller("NonprofitSignupCtrl",["$scope","$rootScope","$filter","$state","Auth","Photos","Restangular",function(a,b,c,d,e,f,g){a.nonprofit={hidden_address:!1,address:{neighborhood:null,zipcode:null,addressline:null,addressnumber:null},phone:null,description:null,name:null,details:null,user:{name:null,slug:null,email:null,password:null},facebook_page:null,google_page:null,twitter_handle:null,website:null,causes:[]},a.$watch("nonprofit.user.email",function(b){e.isEmailUsed(b,function(b){a.signupForm.email.alreadyUsed=b.alreadyUsed,a.signupForm.email.$invalid=b.alreadyUsed})}),a.$watch("nonprofit.user.slug",function(b){b?b.indexOf(" ")>=0?(a.signupForm.slug.$invalid=!0,a.signupForm.slug.hasSpace=!0):(a.signupForm.slug.$invalid=!1,a.signupForm.slug.hasSpace=!1,e.isSlugUsed(b,function(b){a.signupForm.slug.alreadyUsed=b.alreadyUsed,a.signupForm.slug.$invalid=b.alreadyUsed})):(a.signupForm.slug.alreadyUsed=!1,a.signupForm.slug.hasSpace=!1,a.signupForm.slug.$invalid=!1)}),a.cityLoaded=!1,a.$watch("nonprofit.address.state",function(b){if(a.cityLoaded=!1,a.stateCities=[],b&&!b.citiesLoaded)g.all("cities").getList({page_size:3e3,state:b.id}).then(function(c){c.forEach(function(b){a.stateCities.push(b),b.active||a.cities().push(b)}),b.citiesLoaded=!0,a.cityLoaded=!0});else if(b){var c=a.cities();c.forEach(function(b){b.state.id===a.nonprofit.address.state.id&&a.stateCities.push(b)}),a.cityLoaded=!0}}),a.$watch("password + passwordConfirm",function(){a.signupForm.password.doesNotMatch=a.password!==a.passwordConfirm,a.signupForm.password.$invalid=a.signupForm.password.doesNotMatch}),a.addCause=function(b){if(b.checked=!b.checked,b.checked)a.nonprofit.causes.push(b);else{var c=a.nonprofit.causes.indexOf(b);c>-1&&a.nonprofit.causes.splice(c,1)}a.causeChoosen=0!==a.nonprofit.causes.length?!0:!1},a.uploadImageFile=function(b){return b?(a.files||(a.files=new FormData),a.files.append("image",b[0]),a.imageUploaded=!0,void a.$apply()):(a.imageUploaded=!1,void a.$apply())},a.uploadCoverFile=function(b){return b?(a.files||(a.files=new FormData),a.files.append("cover",b[0]),a.coverUploaded=!0,void a.$apply()):(a.coverUploaded=!1,void a.$apply())},a.signup=function(){a.nonprofit.user.password=a.password,a.facebook_page="http://facebook.com/"+a.facebook_page,a.google_page="http://plus.google.com/"+a.google_page,a.twitter_handle="http://www.twitter.com/"+a.twitter_handle,a.files.append("nonprofit",angular.toJson(a.nonprofit)),e.nonprofitSignup(a.files,function(){e.login({username:a.nonprofit.user.email,password:a.nonprofit.user.password,remember:!0},function(){e.getCurrentUser().then(function(b){a.loggedUser=b,toastr.success("Bem vinda ONG ao atados! Sua ONG ainda precisa ser aprovada. Espere pelo nosso email."),d.transitionTo("root.home")},function(a){console.error(a),toastr.error('Sua ONG foi criada mas não coseguimos te logar. Clique no botão acima "ONG" e use seu email e senha para logar.'),d.transitionTo("root.home")})},function(){a.error="Usuário ou senha estão errados :("})},function(a){console.error(a),toastr.error("Erro no servidor. Por favor entre em contato.")})}}]);var app=angular.module("atadosApp");app.factory("Project",["$http","Restangular","Site","Auth","Cleanup","$state",function(a,b,c,d,e,f){return{create:function(b,c,d){a.post(constants.api+"create/project/",b,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(c).error(d)},save:function(b,c,d){var e={};
angular.copy(b,e),delete e.nonprofit,delete e.volunteers,delete e.volunteers_numbers,delete e.nonprofit_city_state,delete e.nonprofit_image,delete e.image_url,e.job?(e.job.start_date=new Date(e.job.start_date).getTime(),e.job.end_date=new Date(e.job.end_date).getTime(),delete e.work):e.work&&delete e.job;var f=[];e.causes.forEach(function(a){f.push(a.id)}),e.causes=f;var g=[];e.skills.forEach(function(a){g.push(a.id)}),e.skills=g,a.put(constants.api+"save/project/",{project:e}).success(c).error(d)},get:function(a){return b.one("project",a).get().then(function(a){return e.project(a),a},function(){f.transitionTo("root.home"),toastr.error("Ato não encontrado.")})},getSlug:function(b,c,d){a.get(constants.api+"create_project_slug/?name="+b).success(c).error(d)}}}]);var app=angular.module("atadosApp");app.factory("Work",["$http","$q",function(a,b){return{get:function(c){var d=b.defer();return a.get(constants.api+"works/"+c+"/").success(function(a){d.resolve(a)}),d.promise}}}]);var app=angular.module("atadosApp");app.factory("Job",["$http","$q",function(a,b){return{get:function(c){var d=b.defer();return a.get(constants.api+"jobs/"+c+"/").success(function(a){d.resolve(a)}),d.promise}}}]);var app=angular.module("atadosApp");app.controller("ProjectCtrl",["$scope","$rootScope","$state","$stateParams","$http","Auth","$modal","Volunteer","project",function(a,b,c,d,e,f,g,h,i){function j(){var b="/partials/volunteerContractModal.html",c="ProjectModalCtrl";a.alreadyApplied&&(b="/partials/volunteerUnapplyModal.html",c=function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel"),a.showApplyModal=!1}});var d=g.open({templateUrl:b,resolve:{nonprofit:function(){return a.project.nonprofit},phone:function(){return a.loggedUser.user.phone},name:function(){return a.loggedUser.user.name}},controller:c});d.result.then(function(b){var c="",d="",f="";b&&(c=b.message,d=b.phone,f=b.name),e.post(constants.api+"apply_volunteer_to_project/",{project:a.project.id,message:c}).success(function(c){"Applied"===c[0]?(a.project.volunteers.push(a.loggedUser),a.alreadyApplied=!0,toastr.success("Parabéns! Você é voluntário para "+a.project.name),b&&(a.alreadyApplied||d&&(a.loggedUser.user.phone=d,a.loggedUser.user.name=f,h.save(a.loggedUser,function(){},function(){})))):(a.project.volunteers.splice(a.project.volunteers.indexOf(a.loggedUser),1),a.alreadyApplied=!1,toastr.success("Você não é mais voluntário para "+a.project.name))}).error(function(a){a[403]?g.open({template:'<div class="modal-body"><p>Para ser voluntário, você precisar confirmar sua conta no Atados clicando no link que te mandamos por email quando você criou sua conta.</p><button class="btn btn-info" ng-click="ok()">Ok</button></div>',controller:function(a,b){a.ok=function(){b.close()}}}):toastr.error("Não conseguimos te atar. Por favor mande um email para resolvermos o problema: contato@atados.com.br")})},function(){})}a.landing=!1,a.markers=[],a.project=i,window.project=i,a.nonprofit=a.project.nonprofit,a.site.title="Ato - "+a.project.name,a.markers.push(i.address),a.options={map:{center:new google.maps.LatLng(a.project.address.latitude,a.project.address.longitude),zoom:15}},!i.published&&a.loggedUser&&i.nonprofit.id!==a.loggedUser.id&&(c.transitionTo("root.home"),toastr.error("Ato ainda não foi aprovado. Se isso é um erro entre em contato por favor.")),a.loggedUser&&a.loggedUser.role===constants.VOLUNTEER&&e.get(constants.api+"has_volunteer_applied/?project="+i.id.toString()).success(function(b){a.alreadyApplied="YES"===b[0]?!0:!1}),a.$watch("center",function(b){b&&46===b.d&&(a.center=new google.maps.LatLng(a.project.address.latitude,a.project.address.longitude))}),b.$on("userLoggedIn",function(){c.is("root.project")&&a.showApplyModal&&!a.alreadyApplied?j():a.showApplyModal=!1}),b.$on("userLoggedOut",function(){a.alreadyApplied=!1}),a.showApplyModal=!1,a.applyVolunteerToProject=function(){a.loggedUser?j():(a.openVolunteerModal(),a.showApplyModal=!0,toastr.info("Você tem que logar primeiro!"))}}]);var app=angular.module("atadosApp");app.controller("ProjectEditCtrl",["$scope","$state","$stateParams","Project","Photos",function(a,b,c,d,e){if(a.loggedUser&&a.loggedUser.role===constants.NONPROFIT){var f=!1;a.loggedUser.projects.forEach(function(b){b.slug===c.slug&&(f=!0,a.project=b,window.project=b)}),f||(b.transitionTo("root.home"),toastr.error("A ONG logada não é dona deste ato e não tem acesso de edição."))}else b.transitionTo("root.home"),toastr.error("Precisa estar logado como ONG do ato para editar");if(a.jobActive=a.project.job?!0:!1,a.causes().forEach(function(b){a.project.causes.forEach(function(c){c.id===b.id&&(b.checked=!0,a.causeChosen=!0)})}),a.skills().forEach(function(b){a.project.skills.forEach(function(c){c.id===b.id&&(b.checked=!0,a.skillChosen=!0)})}),a.project.work){for(var g=[],h=0;3>h;h++){var i=[];g.push(i);for(var j=0;7>j;j++)i.push({checked:!1,weekday:j,period:h})}g.forEach(function(b){b.forEach(function(b){a.project.work.availabilities&&a.project.work.availabilities.forEach(function(a){a.weekday===b.weekday&&b.period===a.period&&(b.checked=!0)})})}),a.project.work.availabilities=g}a.project.image_url&&(a.imageUploaded=!0),a.$watch("project.job",function(b){b&&b%1!==0&&(a.start_date=new Date(b.start_date),a.end_date=new Date(b.end_date))}),a.start_date=new Date,a.end_date=new Date,a.$watch("project.name",function(b,c){b!==c&&d.getSlug(b,function(b){a.project.slug=b.slug},function(a){console.error(a)})}),a.$watch("short_facebook_event",function(b){a.project.facebook_event=b?"https://www.facebook.com/events/"+b:null}),a.cityLoaded=!1,a.$watch("start_date",function(b){b&&a.project.job&&(a.project.job.start_date=b.getTime())}),a.$watch("end_date",function(b){b&&a.project.job&&(a.project.job.end_date=b.getTime())}),a.uploadProjectImage=function(b){if(b){var c=new FormData;c.append("file",b[0]),e.setProjectPhoto(c,a.project.id,function(b){a.project.image_url=b.file,toastr.success("Foto do ato salva com sucesso."),a.imageUploaded=!0},function(){a.imageUploaded=!1,toastr.error("Error no servidor. Não consigo atualizar foto do ato :(")})}},a.addCause=function(b){b.checked=!b.checked,b.checked?a.project.causes.push(b):a.project.causes.forEach(function(c){if(c.id===b.id){var d=a.project.causes.indexOf(c);if(d>-1)return void a.project.causes.splice(d,1)}}),a.causeChosen=0!==a.project.causes.length?!0:!1},a.addSkill=function(b){b.checked=!b.checked,b.checked?a.project.skills.push(b):a.project.skills.forEach(function(c){if(c.id===b.id){var d=a.project.skills.indexOf(c);if(d>-1)return void a.project.skills.splice(d,1)}}),a.skillChosen=0!==a.project.skills.length?!0:!1},a.ismeridian=!0,a.toggleMode=function(){a.ismeridian=!a.ismeridian},a.removeRole=function(b){a.project.roles.splice(a.project.roles.indexOf(b),1)},a.addRole=function(b){b.vacancies&&b.name&&b.details?(a.project.roles.push(a.newRole),a.newRole={}):toastr.error("Esqueceu alguma informação do cargo?")},a.saveProject=function(){if(a.causes().forEach(function(a){a.checked=!1}),a.skills().forEach(function(a){a.checked=!1}),a.jobActive)delete a.project.work;else{var c=[];a.project.work.availabilities.forEach(function(a){a.forEach(function(a){a.checked&&c.push(a)})}),a.project.work.availabilities=c,delete a.project.job}d.save(a.project,function(c){a.project=c,toastr.success("Ato salvo."),b.transitionTo("root.nonprofitadmin",{slug:a.loggedUser.slug})},function(){toastr.error("Não consigo salvar Ato. Entre em contato com o Atados para resolver o problema.")})}}]);var app=angular.module("atadosApp");app.controller("ProjectModalCtrl",["$scope","$modalInstance","nonprofit","phone","name",function(a,b,c,d,e){a.nonprofit=c,a.contractForm={},a.contractForm.phone=d,a.contractForm.name=e,a.contractForm.message="Deixe sua mensagem aqui...",a.phoneWarningMessage="",a.ok=function(){a.contractForm.phone||a.phoneWarningMessage?b.close({phone:a.contractForm.phone,name:a.contractForm.name,message:a.contractForm.message}):a.phoneWarningMessage="Não é obrigátorio colocar seu telefone e nome. Mas vai ajudar muito a ONG a entrar em contato com você rapidamente. Se você quer continuar sem telefone click em Ok e você vai ser cadastrado"},a.cancel=function(){b.dismiss("cancel")}}]);var app=angular.module("atadosApp");app.controller("ProjectNewCtrl",["$scope","$state","Restangular","Project",function(a,b,c,d){a.jobActive=!0,a.project={name:"",slug:"",nonprofit:null,address:{city:{},neighborhood:"",zipcode:"",addressline:"",addressline2:"",addressnumber:""},description:"",details:"",responsible:"",phone:"",email:"",causes:[],skills:[],roles:[]},a.job={start_date:new Date,end_date:new Date},a.work={availabilities:[],weekly_hours:0,can_be_done_remotely:!1};for(var e=0;3>e;e++){var f=[];a.work.availabilities.push(f);for(var g=0;7>g;g++)f.push({checked:!1,weekday:g,period:e})}a.newRole={name:"",prerequisites:"",details:"",vacancies:0},window.project=a.project,a.loggedUser&&a.loggedUser.role===constants.NONPROFIT?(a.project.nonprofit=a.loggedUser.id,a.project.address.city.id=a.loggedUser.address.city):(b.transitionTo("root.home"),toastr.error("Precisa estar logado como ONG para fazer cadastro de um novo ato")),a.$watch("project.name",function(b){b&&d.getSlug(b,function(b){a.project.slug=b.slug},function(a){console.error(a)})}),a.$watch("short_facebook_event",function(b){b&&(a.project.facebook_event="https://www.facebook.com/events/"+b)}),a.$watch("start_date",function(b){b&&(a.job.start_date=b.getTime())}),a.$watch("end_date",function(b){b&&(a.job.end_date=b.getTime())}),a.uploadProjectImage=function(b){return b?(a.files||(a.files=new FormData),a.files.append("image",b[0]),a.imageUploaded=!0,void a.$apply()):(a.imageUploaded=!1,void a.$apply())},a.addCause=function(b){if(b.checked=!b.checked,b.checked)a.project.causes.push(b);else{var c=a.project.causes.indexOf(b);c>-1&&a.project.causes.splice(c,1)}a.causeChoosen=0!==a.project.causes.length?!0:!1},a.addSkill=function(b){if(b.checked=!b.checked,b.checked)a.project.skills.push(b);else{var c=a.project.skills.indexOf(b);c>-1&&a.project.skills.splice(c,1)}a.skillChoosen=0!==a.project.skills.length?!0:!1},a.minDate=new Date,a.ismeridian=!0,a.toggleMode=function(){a.ismeridian=!a.ismeridian},a.removeRole=function(b){a.project.roles.splice(a.project.roles.indexOf(b),1)},a.addRole=function(b){b.vacancies&&b.name&&b.details?(a.project.roles.push(a.newRole),a.newRole={}):toastr.error("Esqueceu alguma informação do cargo?")},a.createProject=function(){if(a.jobActive)a.project.job=a.job;else{a.project.work=a.work;var c=[];a.work.availabilities.forEach(function(a){a.forEach(function(a){a.checked&&c.push(a)})}),a.work.availabilities=c}a.files.append("project",angular.toJson(a.project)),d.create(a.files,function(){toastr.success("Ato criado com sucesso. Agora espere o Atados entrar em contato para aprovação"),a.loggedUser.projects.push(a.project),b.transitionTo("root.nonprofitadmin",{slug:a.loggedUser.slug})},function(a){console.error(a),toastr.error("Não consigo criar novo Ato. Entre em contato com o Atados.")})}}]);var app=angular.module("atadosApp");app.controller("ExplorerCtrl",["$scope","$rootScope","$filter",function(a,b,c){function d(){var a=window.innerHeight-$(".navbar-header").height()-5;$(".atados-explorer").height(a-40),$(".map-outer .map").height(a)}a.site.title="Atados - Explore",a.landing=!1,b.explorerView=!0,a.$on("$destroy",function(){b.explorerView=!1}),d(),$(window).resize(function(){d()}),$(".atados-explorer").scroll(function(){$(".atados-explorer").scrollTop()>=$("#searchSpace").height()-$(window).height()&&a.getMore()}),a.objects=a.search.showProjects?a.search.projects():a.search.nonprofits(),a.previousMarker=null,a.iw=new google.maps.InfoWindow,a.oms=null,a.markers=constants.markers,a.$on("gmMarkersUpdated",function(){if(a.map&&!a.oms&&(a.oms=new OverlappingMarkerSpiderfier(a.map),a.oms.addListener("spiderfy",function(){a.iw.close()}),a.oms.addListener("unspiderfy",function(){a.iw.close()}),a.oms.addListener("click",a.selectMarker)),a.oms)for(var b in a.markers)a.markers[b].setIcon(constants.notselected),a.oms.addMarker(a.markers[b])}),a.mapOptions={map:{center:constants.saoPauloCenter,zoom:constants.defaultZoom},marker:{clickable:!0,draggable:!1}},a.$watch("search.projects()",function(){a.search.showProjects&&(a.objects=a.search.projects())}),a.$watch("search.nonprofits()",function(){a.search.showProjects||(a.objects=a.search.nonprofits())}),a.$watch("search.showProjects",function(){a.objects=a.search.showProjects?a.search.projects():a.search.nonprofits()}),a.removeMarker=function(a,b){angular.element(document.querySelector("#card-"+b.slug)).removeClass("hover")},a.selectMarker=function(b,c){if(a.previousMarker&&(a.previousMarker.setIcon(constants.notselected),angular.element(document.querySelector("#card-"+a.previousMarker.slug)).removeClass("hover"),a.previousMarker.setZIndex(1),a.previousMarker=null),c&&!b&&(b=a.markers[c.slug]),b){var d="card-"+b.slug;a.iw.setContent(b.title),a.iw.open(constants.map,b),b.setIcon(constants.selected),angular.element(document.querySelector("#"+d)).addClass("hover"),b.setZIndex(100),a.previousMarker=b,constants.map.setCenter(b.getPosition())}},a.getMarkerOpts=function(a){var b="";return b=a.user?'<div id="info-window"><h4><a href="/ong/'+a.slug+'">'+a.name+"</a></h4><p>"+c("as_location_string")(a.address)+"</p></div>":'<div id="info-window"><h4><a href="/ato/'+a.slug+'">'+a.name+"</a></h4><p>"+c("as_location_string")(a.address)+"</p></div>",angular.extend({title:b},{slug:a.slug})}}]);var app=angular.module("atadosApp");app.factory("Search",["Restangular","Site",function(a,b){function c(b,c,d,e,f,g){g="undefined"!=typeof g?g:constants.page_size;var i={page_size:g,query:b,cause:c,skill:d,city:e,highlighted:f};n=!0,a.all("projects").getList(i).then(function(a){h=[],p(a),n=!1},function(){console.error("Não consegui pegar os atos do servidor."),n=!1})}var d="",e={},f={},g={},h=[],i=[],j="",k="",l=0,m=0,n=!1,o=function(a){return a&&constants.api!==constants.devApi?a.replace("http","https"):a},p=function(a){a.forEach(r),a._resultmeta?(j=o(a._resultmeta.next),l=a._resultmeta.count):j=""},q=function(a){a.forEach(s),a._resultmeta?(k=o(a._resultmeta.next),m=a._resultmeta.count):k=""},r=function(a){a.causes.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png",a.class="cause_"+a.id}),a.skills.forEach(function(a){a.image=constants.storage+"skill_"+a.id+".png",a.class="skill_"+a.id}),h.push(a)},s=function(a){var c=[];a.causes.forEach(function(a){var d={};d.id=b.causes()[a].id,d.name=b.causes()[a].name,d.class=b.causes()[a].class,d.image=b.causes()[a].image,d.checked=!0,c.push(d)}),a.causes=c,a.address=a.user.address,i.push(a)},t=function(b,c,d,e){var f={page_size:20,query:b,cause:c,city:d,highlighted:e};n=!0,a.all("nonprofits").getList(f).then(function(a){i=[],q(a),n=!1},function(){console.error("Não consegui pegar ONGs do servidor."),n=!1})};return{filter:function(a,b,d,e,f){h=[],i=[],c(a,b,d,e,f),t(a,b,e,f)},query:d,cause:e,skill:f,city:g,loading:function(){return n},showProjects:!0,projectCount:function(){return l},nonprofitCount:function(){return m},nextUrlProject:function(){return j},nextUrlNonprofit:function(){return k},setNextUrlProject:function(a){j=o(a)},setNextUrlNonprofit:function(a){k=o(a)},projects:function(){return h},nonprofits:function(){return i}}}]);var app=angular.module("atadosApp");app.controller("SearchCtrl",["$scope","$http","$location","$anchorScroll","Search",function(a,b,c,d,e){a.search=e,a.map=constants.map,a.highlighted=a.landing;var f=!1,g=!1;0===e.nonprofits().length&&0===e.projects().length&&e.filter(null,null,null,null,a.highlighted),a.$watch("search.city",function(b){a.zoom=constants.defaultZoom,"Sao Paulo"===b.name?a.center=constants.saoPauloCenter:"Curitiba"===b.name?a.center=constants.curitibaCenter:"Brasilia"===b.name?a.center=constants.brasiliaCenter:0===b.id&&(a.center=null,a.zoom=1)});var h=function(b,c){b!==c&&(f=!1,g=!1,e.filter(e.query,e.cause.id,e.skill.id,e.city.id,a.highlighted))};a.$watch("search.cause",function(a,b){h(a,b)}),a.$watch("search.skill",function(a,b){h(a,b)}),a.$watch("search.city",function(a,b){h(a,b)}),a.$watch("search.query",function(a,b){h(a,b)}),a.getMore=function(){if(a.landing){var c={showProjects:a.search.showProjects,city:a.search.city,cause:a.search.cause,skill:a.search.skill};a.$emit("landingToExplorer",c)}a.search.showProjects?a.search.nextUrlProject()?b.get(a.search.nextUrlProject()).success(function(b){b.results.forEach(function(b){b.causes.forEach(function(a){a.image=constants.storage+"cause_"+a.id+".png",a.class="cause_"+a.id}),a.search.projects().push(b)}),a.search.setNextUrlProject(b.next)}).error(function(){toastr.error("Erro ao buscar mais atos do servidor")}):f||(toastr.error("Não conseguimos achar mais atos. Tente mudar os filtros."),f=!0):a.search.nextUrlNonprofit()?b.get(a.search.nextUrlNonprofit()).success(function(b){b.results.forEach(function(b){b.address=b.user.address;var c=[];b.causes.forEach(function(a){var b={};b.image=constants.storage+"cause_"+a+".png",b.class="cause_"+a,c.push(b)}),b.causes=c,a.search.nonprofits().push(b)}),a.search.setNextUrlNonprofit(b.next)}).error(function(){toastr.error("Erro ao buscar mais ONGs do servidor")}):g||(toastr.error("Não conseguimos achar mais ONGs. Tente mudar os filtros."),g=!0)}}]);var app=angular.module("atadosApp");app.factory("Volunteer",["$http","$state","Restangular","Cleanup",function(a,b,c,d){return{save:function(b,c,d){var e={};angular.copy(b,e),delete e.projects,delete e.nonprofits,delete e.address,delete e.skills,delete e.causes,delete e.user.address.city,a.put(constants.api+"volunteers/"+e.slug+"/.json",e).success(c).error(d)},get:function(a){return c.one("volunteers_public",a).get().then(function(a){return d.volunteer(a),a},function(){b.transitionTo("root.home"),toastr.error("Voluntário não encontrado")})}}}]);var app=angular.module("atadosApp");app.controller("VolunteerCtrl",["$scope","volunteer",function(a,b){a.volunteer=b,a.landing=!1,window.volunteer=b,a.site.title="Voluntário - "+b.slug,a.selectMarker=function(a,b){angular.element(document.querySelector("#card-"+b.slug)).addClass("hover")},a.removeMarker=function(a,b){angular.element(document.querySelector("#card-"+b.slug)).removeClass("hover")}}]);var app=angular.module("atadosApp");app.controller("VolunteerEditCtrl",["$scope","$filter","Auth","Photos","$http","Restangular","$state",function(a,b,c,d,e,f,g){a.$watch("loggedUser",function(a){a||(toastr.error("Voluntário não logado para editar."),g.transitionTo("root.home"))}),a.volunteerCauses=[],a.volunteerSkills=[],a.loggedUser&&a.loggedUser.role===constants.VOLUNTEER?(a.savedEmail=a.loggedUser.user.email,a.volunteer=a.loggedUser,a.causes().forEach(function(b){var c={};c.id=b.id,c.name=b.name,c.class=b.class,c.image=b.image,a.volunteerCauses.push(c)}),a.volunteer.causes.forEach(function(b){a.volunteerCauses[b.id].checked=!0}),a.skills().forEach(function(b){var c={};c.id=b.id,c.name=b.name,c.class=b.class,c.image=b.image,a.volunteerSkills.push(c)}),a.volunteer.skills.forEach(function(b){a.volunteerSkills[b.id].checked=!0})):(g.transitionTo("root.home"),toastr.error("Voluntário não logado para editar.")),a.addCause=function(a){a.checked=!a.checked},a.addSkill=function(a){a.checked=!a.checked},a.cityLoaded=!1,a.$watch("volunteer.address.state",function(b){if(a.cityLoaded=!1,a.stateCities=[],b&&!b.citiesLoaded)f.all("cities").getList({page_size:3e3,state:b.id}).then(function(c){c.forEach(function(b){a.stateCities.push(b),a.volunteer.address.city&&b.id===a.volunteer.address.city.id&&(a.volunteer.address.city=b),b.active||a.cities().push(b)}),b.citiesLoaded=!0,a.cityLoaded=!0});else if(b){var c=a.cities();c.forEach(function(b){b.state.id===a.volunteer.address.state.id&&a.stateCities.push(b)}),a.cityLoaded=!0}}),a.uploadProfileFile=function(b){if(b){var c=new FormData;c.append("file",b[0]),d.setVolunteerPhoto(c,function(b){a.volunteer.image_url=b.file,toastr.success("Foto do voluntário salva com sucesso.")},function(){toastr.error("Error no servidor. Não consigo atualizar sua foto :(")})}},a.saveVolunteer=function(){var b=[];a.volunteerCauses.forEach(function(a){a.checked&&b.push(a.id)}),a.volunteer.causes=b;var d=[];a.volunteerSkills.forEach(function(a){a.checked&&d.push(a.id)}),a.volunteer.skills=d;var f={};angular.copy(a.volunteer,f),delete f.projects,delete f.nonprofits,f.address&&f.address.city&&(f.address.city=f.address.city.id,delete f.address.state),f.user.address=f.address,a.volunteer.birthDate&&"undefined"!=typeof a.volunteer.birthDate.getFullYear&&(f.birthDate=a.volunteer.birthDate.getFullYear()+"-"+(a.volunteer.birthDate.getMonth()+1)+"-"+a.volunteer.birthDate.getDate()),e.put(constants.api+"volunteers/"+f.slug+"/.json",f).success(function(){toastr.success("Perfil salvo!",a.volunteer.slug)}).error(function(){toastr.error("Problema em salvar seu perfil :(")}),a.password&&a.password===a.passwordConfirm&&c.changePassword({email:a.volunteer.user.email,password:a.password},function(){toastr.success("Senha nova salva",a.volunteer.slug)},function(){toastr.error("Não conseguimos atualizar sua senha :(")})},a.$watch("causes + volunteer.causes",function(){a.causes()&&a.volunteer&&a.volunteer.causes.forEach(function(b){for(var c=0;c<a.causes().length;++c){var d=a.causes()[c];if(d.url===b){d.checked=!0;break}}})}),a.$watch("skills + volunteer.skills",function(){a.skills&&a.volunteer&&a.volunteer.skills&&a.volunteer.skills.forEach(function(b){for(var c=0;c<a.skills.length;++c){var d=a.skills[c];if(d.url===b){d.checked=!0;break}}})}),a.$watch("volunteer.user.email",function(b,d){b&&b!==d&&b!==a.savedEmail?c.isEmailUsed(b,function(b){a.volunteerEditForm.email.alreadyUsed=b.alreadyUsed,a.volunteerEditForm.email.$invalid=b.alreadyUsed}):(a.volunteerEditForm.email.$invalid=!1,a.volunteerEditForm.email.alreadyUsed=!1)}),a.getFacebookPhoto=function(){a.volunteer.facebook_uid&&d.getFacebookPhoto(function(b){toastr.success("Foto do facebook salva com sucesso"),a.volunteer.image_url=b},function(a){console.error(a),toastr.error("Error no servidor. Não consigo pegar foto do Facebook.")})},a.$watch("password + passwordConfirm",function(){a.volunteerEditForm.password.doesNotMatch=a.password!==a.passwordConfirm,a.volunteerEditForm.password.$invalid=a.volunteerEditForm.password.doesNotMatch})}]);var app=angular.module("atadosApp");app.controller("VolunteerModalCtrl",["$scope","$rootScope","$FB","Auth",function(a,b,c,d){function e(a){d.facebookAuth(a,function(a){b.$emit("userLoggedIn",a)},function(){toastr.error("Houve um error no servidor tentando logar com sua conta no Facebook.")})}a.loginActive=!0,a.$watch("loginActive",function(b){a.facebookState=b?"Entrar ":"Criar conta "}),a.switchLoginActive=function(){a.loginActive=!a.loginActive},a.facebookAuth=function(){c.getLoginStatus(function(a){"connected"!==a.status?c.login(function(b){"connected"===b.status?e(b.authResponse):"not_authorized"===a.status},{scope:"email"}):a.authResponse?e(a.authResponse):toastr.error("Could not get facebook credentials")})}}]);var app=angular.module("atadosApp");app.controller("VolunteerSignupCtrl",["$scope","$rootScope","Auth",function(a,b,c){a.$watch("slug",function(b){b?b.indexOf(" ")>=0?(a.signupForm.slug.$invalid=!0,a.signupForm.slug.hasSpace=!0,a.signupForm.slug.alreadyUsed=!1):(a.signupForm.slug.hasSpace=!1,a.signupForm.slug.$invalid=!1,c.isSlugUsed(b,function(b){a.signupForm.slug.alreadyUsed=b.alreadyUsed,a.signupForm.slug.$invalid=b.alreadyUsed})):(a.signupForm.slug.alreadyUsed=!1,a.signupForm.slug.hasSpace=!1,a.signupForm.slug.$invalid=!1)}),a.$watch("email",function(b){b?c.isEmailUsed(b,function(b){a.signupForm.email.alreadyUsed=b.alreadyUsed,a.signupForm.email.$invalid=b.alreadyUsed}):a.signupForm.email.alreadyUsed=!1}),a.$watch("password + passwordConfirm",function(){a.passwordDoesNotMatch=a.password!==a.passwordConfirm}),a.signup=function(){a.signupForm.$valid&&c.volunteerSignup({slug:a.slug,email:a.email,password:a.password},function(){c.login({username:a.email,password:a.password,remember:a.remember},function(){c.getCurrentUser().then(function(a){b.$emit("userLoggedIn",a)},function(a){toastr.error(a)})},function(){a.error="Usuário ou senha estão errados :("})},function(a){console.error(a),toastr.error("Não conseguimos criar sua conta agora. :(")})}}]);