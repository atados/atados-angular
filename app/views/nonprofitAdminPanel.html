<div id="nonprofit-admin">
  <div id="nonprofit-page">
    <div class="cover">
      <img alt="{{nonprofit.slug}}" ng-src="{{nonprofit.cover_url}}"/>
    </div>

    <div id="nonprofit-details" class="row">

      <div id="left-sidebar" class="col-xs-2">
        <div id="logo">
          <img alt="{{nonprofit.slug}}" class="img-responsive" ng-src="{{nonprofit.image_url}}"/>
        </div>
        <div id="nonprofit-map">
          <gm-map
          gm-map-id="'nonprofitAddressMap'"
          gm-center="center"
          gm-zoom="zoom"
          gm-map-type-id="mapTypeId"
          style="width:100%;height:100%">
          <gm-markers gm-objects="markers"
          gm-get-lat-lng="{ lat: object.latitude, lng: object.longitude }"
          gm-events="markerEvents">
          </gm-markers>
          </gm-map>
        </div>
        <div id="nonprofit-social">
          <a ng-if="nonprofit.facebook_page" href="{{nonprofit.facebook_page}}" target="_blank"><i class="fa fa-facebook"></i></a>
          <a ng-if="nonprofit.google_page" href="{{nonprofit.google_page}}" target="_blank"><i class="fa fa-twitter"></i></a>
          <a ng-if="nonprofit.twitter_handle" href="{{nonprofit.twitter_handle}}" target="_blank"><i class="fa fa-google-plus"></i></a>
        </div>
        <div class="fb-like-box" data-href="{{nonprofit.facebook_page}}" data-width="200" data-height="268" data-colorscheme="light" data-show-faces="false" data-header="false" data-stream="false" data-show-border="false"></div>
      </div>
      <div class="col-md-9 col-sm-8 col-xs-7">
        <h1 ng-hide="editing">{{nonprofit.name}}</h1>
        <form ng-show="editing" ng-submit="doneEditing(nonprofit)">
          <input ng-model="nonprofit.name">
        </form>

        <button class="btn btn-info pull-right" ng-click="createNewProject()">Criar Novo Ato</button>
        <button class="btn btn-info pull-right" ng-hide="editing" ng-click="editing=true">Editar Perfil</button>
        <button class="btn btn-info pull-right" ng-show="editing" ng-click="editing=false">Parar de Editar Perfil</button>

        <p ng-if="nonprofit.website"><i class="fa fa-laptop col-xs-1"></i><a href="{{nonprofit.website}}" target="_blank">{{nonprofit.website}}</a></p>
        <p ng-if="nonprofit.user.email"><i class="fa fa-inbox col-xs-1"></i><a href="mailto:{{nonprofit.user.email}}" target="_blank">{{nonprofit.user.email}}</a></p>
        <p ng-if="nonprofit.user.phone"><i class="fa fa-phone col-xs-1"></i>{{nonprofit.user.phone}}</p>
        <p ng-if="nonprofit.address"><i class="fa fa-map-marker col-xs-1"></i>{{nonprofit.address | as_location_string}}</p>
        <div id="nonprofit-causes">
          <div class="img-circle cause-image" ng-repeat="cause in nonprofit.causes"> 
            <img tooltip="{{cause.name}}" width="20" height="20" ng-src="/images/{{cause.class}}.png"/>
          </div>
        </div>

        <h3>Sobre</h3>
        <div ng-hide="editing" ng-bind-html="nonprofit.details | noHTML | newlines"></div>
        <form ng-show="editing" ng-submit="doneEditing(nonprofit)">
          <textarea ng-model="nonprofit.details"></textarea>
        </form>
        <div ng-show="editing" ng-bind-html="nonprofit.details | noHTML | newlines"></div>

        <div id="project-management" class="row">
          <div class="col-md-3" id="project-list">
            <button class="btn col-md-12" ng-repeat="project in nonprofit.projects" ng-class="{choosenProject: project===activeProject}" ng-click="changeActiveProject(project)" >{{project.name}} <span ng-show="project.volunteers.length" ng-style="{'background-color': '{{project.statusStyle}}'}" class="badge">{{project.volunteers.length}}</span></button>
          </div>
          <div class="col-md-9" id="active-project">
            <div id="project-name">
              <h3>
                <a ng-href="/ato/{{activeProject.slug}}">{{activeProject.name}}</a>
                                <span tooltip="Ato não pode mais receber voluntários mas ainda está visivel na internet." ng-show="activeProject.closed && activeProject.published" class="pull-right label label-danger">Ato Finalizado</span>
                <span tooltip="Aberto para o público da internet ver e se atar !" ng-show="!activeProject.closed && activeProject.published" class="pull-right label label-success">Ato Aberto</span>
                <span tooltip="O pessoal do Atados está analisando o seu Ato e já entrará em contato!" ng-show="!activeProject.published" class="pull-right label label-warning">Ato em aprovação</span>
              </h3>
            </div>
            <div class="" id="project-action-buttons">
              <a class="" ng-click="editProject(activeProject)" id="edit-project"><i class="fa fa-edit"></i> Editar Ato</a>  
              <a class="" ng-click="cloneProject(activeProject)" id="clone-project"><i class="fa fa-copy"></i> Duplicar Ato</a>  
              <a class="" ng-click="closeOrOpenProject(activeProject)" id="close-project" ng-hide="activeProject.closed"><i class="fa fa-times-circle-o"></i> Fechar Inscrições</a>
              <a class="" ng-click="closeOrOpenProject(activeProject)" id="open-project" ng-show="activeProject.closed"><i class="fa fa-times-circle-o"></i> Abrir Inscrições</a>
              <a class="" href="{{activeProject.emailAllString}}" target="_blank" id="send-email-all"><i class="fa fa-envelope-o"></i> Enviar Email para todos</a>  
              <a class="" ng-click="exportList(activeProject)" id="export-list"><i class="fa fa-table"></i> Exportar lista como planilha</a>  
            </div>
            <table class="table table-striped" id="project-volunteer-table">
              <tr>
                <th>Nome</th>
                <th>Email</th>
                <th>Telefone</th>
                <th>Status</th>
              </tr>
              <tr ng-repeat="volunteer in activeProject.volunteers">
                <td>{{volunteer.name}}</td>
                <td>
                  {{volunteer.email}}
                  <a href="mailto:{{volunteer.email}}" target="_blank" class="pull-right" id="send-email-button"><i tooltip="Mande email só para esse voluntário" class="fa fa-envelope-o"></i></a>
                </td>
                <td>{{volunteer.phone}}</td>
                <td>
                  <li class="dropdown">
                    <a class="dropdown-toggle" ng-style="volunteer.statusStyle">
                      {{volunteer.status}} 
                      <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                      <li ng-repeat="status in volunteerStatusOptions">
                        <a ng-click="changeVolunteerStatus(volunteer, status)">{{status}}</a>
                      </li>
                    </ul>
                  </li>
                </td>
              </tr>
            </table>
            <p class="center" ng-hide="activeProject.volunteers">Esse ato não tem voluntários.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
